{"version":3,"sources":["public/mp/buy-matas.js"],"names":["express","require","buy_matas","Router","mParticle","config","Configuration","apiClient","ApiClient","basePath","api","EventsApi","random_choice","a_src","sel","Math","floor","random","length","weighted_random_choice","data","total","i","threshold","uuidv4","replace","c","r","v","toString","get","req","res","batch","Batch","Environment","development","context","user_identities","UserIdentities","query","customerid","mp_deviceid","a_categories","a_prod_items","matas_product","Product","product_set","name","id","brand","category","quantity","price","coupon_code","custom_attributes","key","value","Object","entries","total_product_amount","substring","product_action","ProductAction","products","total_amount","tax_amount","round","transaction_id","commerce_event","CommerceEvent","currency_code","ceil","timestamp_unixtime_ms","Date","now","addEvent","body","callback","error","response","send","header","JSON","stringify","bulkUploadEvents","module","exports"],"mappings":"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","file":"buy-matas.js","sourceRoot":"../src","sourcesContent":["var express = require('express');\nvar buy_matas = express.Router();\nvar mParticle = require('mparticle');\n\n//https://demo.mp.com/mp/buy_matas?customerid=31160825\n//mParticle Workshop ---> easyJet ---> Custom Feed ---> eRes System\nvar config = new mParticle.Configuration(\n    'us2-0c40b6fcec02354f9179838bc68c8edf',\n    '_FME4g_b9pFY8iAglexCpx9Qt7IA7uhAzvzfgUzI_xo1rCeRntktI7gStxUPuLy3');\nvar apiClient = new mParticle.ApiClient()\napiClient.basePath = 'https://s2s.us2.mparticle.com/v2'\nvar api = new mParticle.EventsApi(config, apiClient);\n\nfunction random_choice(a_src) {\n    var sel = Math.floor(Math.random() * a_src.length)\n    return [a_src[sel], sel];\n}\n\nfunction weighted_random_choice(data) {\n    let total = 0;\n    for (let i = 0; i < data.length; ++i) {\n        total += data[i][1];\n    }\n    // Total in hand, we can now pick a random value akin to our\n    // random index from before.\n    const threshold = Math.random() * total;\n    \n    total = 0;\n    for (let i = 0; i < data.length - 1; ++i) {\n        // Add the weight to our running total.\n        total += data[i][1];\n\n        // If this value falls within the threshold, we're done!\n        if (total >= threshold) {\n            return [data[i][0], i];\n        }\n    }\n\n    // Wouldn't you know it, we needed the very last entry!\n    return [data[data.length - 1][0], data.length - 1];\n}\n\nfunction uuidv4() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\n\nbuy_matas.get('/', function(req, res) {\n    \n    var batch = new mParticle.Batch(mParticle.Batch.Environment.development);\n    batch.context = { \n        \"data_plan\": {\n            \"plan_id\": \"dp_example\",\n            \"plan_version\": 1\n        }\n    }\n    var user_identities = new mParticle.UserIdentities();\n    \n    if ('customerid' in req.query) {\n        user_identities.customerid = req.query['customerid']\n    }\n    batch.user_identities = user_identities;\n    batch.mp_deviceid = \"a8d2ebab-e956-407e-a1e6-f05f871bb9f3\"\n    \n    let a_categories = {\n        \"Skin Care\": [\n            \"Facial Care\",\n            \"Body Care\",\n            \"Dermatological and Special Skin Care\",\n            \"For Mother & Child\",\n            \"Hair Removal\",\n            \"Sun Care\"\n        ],\n        \"Perfumes & Fragrances\": [\n            \"To her\",\n            \"For him\",\n            \"Perfumes\",\n            \"Deodorants\",\n            \"Fragrance for the Home\",\n            \"Shop by Fragrance Family\"\n        ],\n        \"Makeup\": [\n            \"Face\",\n            \"Eyes\",\n            \"Lips\",\n            \"Nails\",\n            \"Accessories\"\n        ],\n        \"Hair\": [\n            \"Shampoo & Hair Care\",\n            \"Hair Colour\",\n            \"Hair Styling\",\n            \"Styling Tools\",\n            \"Hair Cutting\",\n            \"Beard Care\",\n            \"Food Supplements for Hair\",\n            \"Professional Hair Care\",\n            \"Accessories for Hair\"\n        ],\n        \"Health & Wellness\": [\n            \"Dietary supplements\",\n            \"Training & Nutrition\",\n            \"Food and Drinks\",\n            \"Sex & Cohabitation\",\n            \"Natural Remedies\",\n            \"Massage & Wellness\",\n            \"Homeopathy\",\n            \"Miscellaneous\"\n        ],\n        \"Medicine & Care\": [\n            \"Over the counter medicine\",\n            \"Allergy\",\n            \"Support bandage\",\n            \"Blood Pressure Monitors\",\n            \"Eczema & Dry Skin\",\n            \"Ticks & Fleas\",\n            \"Cold\",\n            \"Hands & Feet\",\n            \"Home Tests\",\n            \"Assistive devices\",\n            \"Hygiene\",\n            \"Nose\",\n            \"Patches\",\n            \"Lice\",\n            \"Light Therapy Lamps\",\n            \"Stomach problems\",\n            \"Mosquito\",\n            \"Sore Throat\",\n            \"Stop Smoking\",\n            \"Pain\",\n            \"The Snore\",\n            \"Mushroom\",\n            \"Wound Care\",\n            \"Thermometers\",\n            \"Motion Sickness\",\n            \"Eyes\",\n            \"Ears\"\n        ],\n        \"Clothes & Housing\": [\n            \"Clothes & Housing\",\n            \"Children & Parents\",\n            \"Men\",\n            \"Gifts\",\n            \"News\",\n            \"Talk to an expert\",\n            \"Clothes, Shoes & Accessories\",\n            \"Home interior\",\n            \"Electronics\",\n            \"Household\",\n            \"Accessories for Pets\",\n            \"Travel Accessories\"\n        ],\n        \"Children & Parents\": [\n            \"Breastfeeding and Bottle\",\n            \"The Child's Health\",\n            \"Nappy Time, Bath and Care\",\n            \"Pregnancy and Postpartum\",\n            \"Sleeping Time\",\n            \"Dinner Time\",\n            \"Toy\",\n            \"Baby Equipment\",\n            \"Children's Clothing\"\n        ],\n        \"Men\": [\n            \"Fragrance\",\n            \"Shaving\",\n            \"Beard Care\",\n            \"Skin Care\",\n            \"Hair\",\n            \"Body & Health\",\n            \"Makeup for Men\",\n            \"Men's Clothing\",\n            \"Accessories\"\n        ],\n        \"Gifts\": [\n            \"Gifts for Her\",\n            \"Gifts for Him\",\n            \"Gift Boxes\",\n            \"Gift Card\",\n            \"Host Gifts\",\n            \"Brand Days\"\n        ]\n    };\n    \n    var a_prod_items = [\n        [\"Balancing Force Oil Control Toner 198 ml\", \"714858\", 239.95, \"20%\", \"OLE HENRIKSEN\", \"Skin Care\", \"Facial Care - Cleaning Products - Skin Tonic\", {\"Volume\": \"198ml\"}, \"https://images.matas.dk/trs/w730//Assets_v3/500001-600000/504001-505000/504101-504200/504173/product_v1_x2.jpg\"],\n        [\"Expert Sun Protector SPF 50 + Face and Body 150 ml\", \"753709\", 364.95, \"0%\", \"SHISEIDO\", \"Skin Care\", \"Sun Care - Sun Cream - Sunscreen for the Body\", {\"Volume\": \"150ml\"}, \"https://images.matas.dk/trs/w730//Assets_v3/600001-700000/652001-653000/652601-652700/652686/product_v1_x2.jpg\"],\n        [\"Bedroom.Hair Hairspray 250 ml\", \"720815\", \"227.95\", \"0%\", \"KEVIN MURPHY\", \"Hair\", \"Hair Styling - Hair Spray\", {\"Volume\": \"250ml\"}, \"https://images.matas.dk/trs/w730//Assets_v3/700001-800000/718001-719000/718001-718100/718081/product_v1_x2.jpg\"],\n        [\"Sauvage Eau de Toilette 60 ml\", \"672698\", 659.95, \"0%\", \"DIOR\", \"Perfumes & Fragrances\", \"For Him - Eau de Toilette\", {\"Volume\": \"60ml\"}, \"https://images.matas.dk/trs/w730//Assets_v3/600001-700000/661001-662000/661601-661700/661648/product_v1_x2.jpg\"],\n        [\"Wake-Up Light HF3531/01\", \"749870\", 1599.0, \"0%\", \"PHILIPS\", \"Clothes & Housing\", \"Electronics - Lights & Lamps - Light Therapy Lamps\", {\"Colour\": \"Amber\"}, \"https://images.matas.dk/trs/w730//Assets_v3/700001-800000/765001-766000/765601-765700/765623/product_v1_x2.jpg\"]\n    ];\n\n    var matas_product = new mParticle.Product();\n    \n    var [product_set, sel] = random_choice(a_prod_items);\n    //console.log(\"Product Set: \" + product_set)\n    matas_product.name = product_set[0];\n    matas_product.id = product_set[1];\n    matas_product.brand = product_set[4];\n    matas_product.category = product_set[5];\n    matas_product.quantity = 1;\n    matas_product.price = product_set[2];\n    matas_product.coupon_code = product_set[3]\n    matas_product.custom_attributes = {};\n    for (const [key, value] of Object.entries(product_set[7])) {\n      //console.log(`${key}: ${value}`);\n      matas_product.custom_attributes[key] = value;\n    }\n    matas_product.custom_attributes[\"Sub Category\"] = product_set[6]\n    matas_product.total_product_amount = matas_product.quantity * matas_product.price * (100 - (matas_product.coupon_code.substring(0, matas_product.coupon_code.length - 1)))/100;\n\n    \n    var product_action = new mParticle.ProductAction('purchase');\n    product_action.products = [matas_product];\n    product_action.total_amount = 0;\n    for (var i = 0; i < product_action.products.length; i++) {\n        product_action.total_amount += product_action.products[i].total_product_amount;\n    }\n    product_action.tax_amount = Math.round(product_action.total_amount * 0.25 * 100) / 100;\n    product_action.transaction_id = \"Matas-\" + uuidv4();\n\n    var commerce_event = new mParticle.CommerceEvent();\n    commerce_event.product_action = product_action;\n    commerce_event.currency_code = \"DKK\";\n    commerce_event.custom_attributes = {};\n    commerce_event.custom_attributes['Payment_Type'] = random_choice([\"Dankort\", \"Mobile Pay\", \"Master Card\", \"Visa\", \"Anyday\"])[0];\n    commerce_event.custom_attributes['Delivery_Option'] = random_choice([\"In Store\", \"Matas\", \"GLS\", \"dao\", \"postnord\", \"instaBox\", \"Burd\"])[0];\n    commerce_event.custom_attributes['Club_Points'] = Math.ceil(product_action.total_amount/10);\n    if ('token' in req.query) {\n        commerce_event.custom_attributes['Token'] = req.query['token'];\n    }\n    commerce_event.timestamp_unixtime_ms = Date.now(); //replace with time of transaction\n\n    batch.addEvent(commerce_event);\n    \n    var body = [batch]\n    var callback = function(error, data, response) {\n        if (error) {\n            res.send('Error: ' + error);\n        } else {\n            res.header(\"Content-Type\",'application/json');\n            res.send(JSON.stringify({\n                'Product_Item': a_prod_items[sel][0],\n                'Payment_Amount': matas_product.total_product_amount.toString(),\n                \"Matas_Points\": (Math.ceil(product_action.total_amount/10)).toString(),\n                'Product_Image': a_prod_items[sel][8]\n            }, null, 4));\n        }\n    };\n\n    api.bulkUploadEvents(body, callback);\n\n});\n\nmodule.exports = buy_matas;\n"]}
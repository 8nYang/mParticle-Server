{"version":3,"sources":["public/mp/profile.js"],"names":["express","require","profile","Router","fetch","s_token","request_token","e","headers","body","JSON","stringify","client_id","client_secret","audience","grant_type","mode","method","t","json","access_token","request_user_profile","wSID","mPID","Authorization","user_profile","get","req","res","query","send","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA,IAAIA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIC,OAAO,GAAGF,OAAO,CAACG,MAAR,EAAd;;AACA,IAAIC,KAAK,GAAGH,OAAO,CAAC,YAAD,CAAnB;;AAEA,IAAII,OAAO,GAAG,EAAd;;AACA,eAAeC,aAAf,GAA+B;EAC3B,IAAIC,CAAC,GAAG;IACJC,OAAO,EAAE;MACL,gBAAgB;IADX,CADL;IAIJC,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;MACjB;MACA;MACAC,SAAS,EAAE,kCAHM;MAG8B;MAC/CC,aAAa,EAAE,kEAJE;MAIkE;MACnFC,QAAQ,EAAE,2BALO;MAMjBC,UAAU,EAAE;IANK,CAAf,CAJF;IAYJC,IAAI,EAAE,SAZF;IAaJC,MAAM,EAAE;EAbJ,CAAR;EAeA,IAAIC,CAAC,GAAG,MAAM,CAAC,MAAMd,KAAK,CAAC,4CAAD,EAA+CG,CAA/C,CAAZ,EAA+DY,IAA/D,EAAd;EACAd,OAAO,GAAGa,CAAC,CAACE,YAAZ;EACA,OAAOf,OAAP;AACH;;AAED,eAAegB,oBAAf,CAAoCC,IAApC,EAA0CC,IAA1C,EAAgD;EAC5ClB,OAAO,GAAG,MAAMC,aAAa,EAA7B,CAD4C,CAE5C;;EACA,IAAIY,CAAC,GAAG,0DAA0DI,IAA1D,GAAiE,GAAjE,GAAuEC,IAAvE,GAA8E,0EAAtF,CAH4C,CAGsH;;EAClK,IAAIhB,CAAC,GAAG;IACJC,OAAO,EAAE;MACLgB,aAAa,EAAE,YAAYnB;IADtB,CADL;IAIJY,MAAM,EAAE;EAJJ,CAAR;EAMA,IAAIQ,YAAY,GAAG,MAAM,CAAC,MAAMrB,KAAK,CAACc,CAAD,EAAIX,CAAJ,CAAZ,EAAoBY,IAApB,EAAzB;EACA,OAAOM,YAAP;AACH;;AAEDvB,OAAO,CAACwB,GAAR,CAAY,GAAZ,EAAiB,gBAAeC,GAAf,EAAoBC,GAApB,EAAyB;EACtC,IAAGD,GAAG,CAACE,KAAJ,CAAU,MAAV,CAAH,EAAsB;IAClB,IAAIJ,YAAY,GAAG,MAAMJ,oBAAoB,CAACM,GAAG,CAACE,KAAJ,CAAU,MAAV,CAAD,EAAoBF,GAAG,CAACE,KAAJ,CAAU,MAAV,CAApB,CAA7C;IACAD,GAAG,CAACE,IAAJ,CAAS;MACLL;IADK,CAAT;EAGF,CALF,MAKQ;IACHG,GAAG,CAACE,IAAJ,CAAS,EAAT;EACH;AAEL,CAVD;AAYAC,MAAM,CAACC,OAAP,GAAiB9B,OAAjB","file":"profile.js","sourceRoot":"../src","sourcesContent":["'use strict'\n\nvar express = require('express');\nvar profile = express.Router();\nvar fetch = require('node-fetch');\n\nvar s_token = '';\nasync function request_token() {\n    var e = {\n        headers: {\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            //client_id: \"wawVx2Ejl0K2FUo79pyr6CQWyRmEuXSE\", //us2 mParticle Workshops\n            //client_secret: \"zK57_GIo6de0UHThW7iVEac3d6od4pRVDD0GbAcuaEpRZtlBTeXw0bxYf4KIhhvA\", //us2 mParticle Workshops\n            client_id: \"irrAuwex0d7calyRaknpCYE89omlKEDU\", //eu1 mParticle Workshops\n            client_secret: \"tMZaugEg57IyInCMiySuSU0c4UvB60s4C4ir5FH2tjzYScuUMcWaldjmE1rt9Lnn\", //eu1 mParticle Workshops\n            audience: \"https://api.mparticle.com\",\n            grant_type: \"client_credentials\"\n        }),\n        mode: \"no-cors\",\n        method: \"POST\"\n    };\n    var t = await (await fetch(\"https://sso.auth.mparticle.com/oauth/token\", e)).json();\n    s_token = t.access_token;\n    return s_token;\n}\n\nasync function request_user_profile(wSID, mPID) {\n    s_token = await request_token();\n    //var t = \"https://api.mparticle.com/userprofile/v1/5000011/167/\" + wSID + \"/\" + mPID + \"?fields=user_identities,user_attributes,audience_memberships,attribution\"; //us2 mParticle Workshops\n    var t = \"https://api.mparticle.com/userprofile/v1/4000268/374/\" + wSID + \"/\" + mPID + \"?fields=user_identities,user_attributes,audience_memberships,attribution\"; // eu1 mParticle Workshops\n    var e = {\n        headers: {\n            Authorization: \"Bearer \" + s_token\n        },\n        method: \"GET\"\n    };\n    var user_profile = await (await fetch(t, e)).json();\n    return user_profile\n}\n\nprofile.get('/', async function(req, res) {\n    if(req.query['mPID']) {\n        var user_profile = await request_user_profile(req.query['wSID'], req.query['mPID']);\n        res.send({\n            user_profile\n         });\n     } else {\n         res.send({});\n     }\n    \n});\n\nmodule.exports = profile;"]}
{"version":3,"sources":["public/mp/eJ_app.js","public/mp/flight-update.js"],"names":["parse","require","fs","path","flights","flight_search","airport_code","eJ_flight_price","createReadStream","pipe","delimiter","from_line","on","row","error","console","log","message","module","exports","express","flight_update","Router","mParticle","logger","BigQuery","bigquery","config","Configuration","apiClient","ApiClient","basePath","api","EventsApi","affected_passengers","audience_query","flight_no","departure_date","query","options","location","job","createQueryJob","rows","getQueryResults","forEach","push","get","req","res","length","batches","i","batch","Batch","Environment","development","context","user_identities","UserIdentities","customerid","mp_deviceid","event","AppEvent","CustomEventType","other","custom_attributes","indexOf","addEvent","callback","data","response","send","header","JSON","stringify","bulkUploadEvents"],"mappings":"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","file":"flight-update.js","sourceRoot":"../src","sourcesContent":["const { parse } = require(\"csv-parse\");\nconst fs = require('fs');\nconst path = require('path');\n\nvar flights = {}\nvar flight_search = {}\nvar airport_code = {}\n\nvar eJ_flight_price = {\n    \"Unit_Price\": 0.1,\n    \"Extra Legroom\": [0.3, 0.4],\n    \"Up Front\": [0.2, 0.3, 0.4],\n    \"Standard\": [0.0],\n    \"Standard Plus\": [0.3, 0.4],\n    \"Essentials\": [0.5, 0.6],\n    \"Large Cabin Bag\":[0.12, 0.25],\n    \"15kg Hold Bag\": [0.25, 0.35, 0.55],\n    \"23kg Hold Bag\": [0.45, 0.65],\n    \"26kg Hold Bag\": [0.4, 0.6],\n    \"Discount\": [0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.2, 0.25, 0.3, 0.35],\n    \"Inspire_Me_Type\": \"I don't mind|City explorer|Adventure and the great outdoors|Family holiday|Foodies|Going solo|Honeymoons and romance|Inspired by movies and TV|Instagram hotspots|Music and festivals|Off the beaten track|Sand sun and swim|Snow and slopes (and a little apres)\",\n    \"Inspire_Me_Trip\": \"Anytime|Summer-23|Autumn-23|Winter-23\",\n    \"Inspire_Me_Time\": \"One-Way|7d-Return|14d-Return|Weekend-Return\"\n}\n\nfs.createReadStream(\"/Users/hsyang/Downloads/eCommerce - webApp/mP-Media/src/public/mp/flights-details.txt\")\n    .pipe(parse({ delimiter: \",\", from_line: 2 }))\n    .on(\"data\", function (row) {\n        flights[row[0]] = {};\n        flights[row[0]]['F-IATA'] = row[1]\n        flights[row[0]]['F-City'] = row[2]\n        flights[row[0]]['F-Country'] = row[3]\n        flights[row[0]]['F-Terminal'] = row[4]\n        flights[row[0]]['F-Time'] = row[5]\n        flights[row[0]]['T-IATA'] = row[6]\n        flights[row[0]]['T-City'] = row[7]\n        flights[row[0]]['T-Country'] = row[8]\n        flights[row[0]]['T-Terminal'] = row[9]\n        flights[row[0]]['T-Time'] = row[10]\n        flights[row[0]]['Distance'] = row[11]\n        flights[row[0]]['Duration'] = row[12]\n        \n        airport_code[row[2]] = row[1]\n        \n        if (typeof flight_search[row[2]] == \"undefined\") {\n            flight_search[row[2]] = {}\n            if (typeof flight_search[row[2]][row[7]] == \"undefined\") {\n                flight_search[row[2]][row[7]] = {}\n            }\n        } else {\n            if (typeof flight_search[row[2]][row[7]] == \"undefined\") {\n                flight_search[row[2]][row[7]] = {}\n            }\n        }\n        flight_search[row[2]][row[7]][row[5]] = row[0]\n    })\n    .on(\"error\", function (error) {\n        console.log(error.message);\n    })\n    .on(\"end\", function () {\n        console.log(\"Done\");\n    });\n\nmodule.exports = {\n    flights: flights,\n    flight_search: flight_search,\n    airport_code: airport_code,\n    eJ_flight_price: eJ_flight_price\n}","var express = require('express');\nvar flight_update = express.Router();\nvar mParticle = require('mparticle');\nvar logger = require('morgan');\nconst {flights, flight_search, airport_code, eJ_flight_price} = require('./eJ_app.js');\n\nconst {BigQuery} = require('@google-cloud/bigquery');\nconst bigquery = new BigQuery();\n\n//https://demo.mp.com/mp/flight_update?flight=EZY7512&departure_date=2023-07-23&delay=180\n//mParticle Workshop ---> easyJet ---> Custom Feed ---> Levarti (Disruption)\nvar config = new mParticle.Configuration(\n    'us2-0de9a21b32cca340b649e7886c134428',\n    'hsVsm8K6ZEvD7J0XPrIrURMxpafHXf9niCIhz21q3-dsZrtUXSk5nmdSd2P_ME7m'\n);\nvar apiClient = new mParticle.ApiClient();\napiClient.basePath = 'https://s2s.us2.mparticle.com/v2';\nvar api = new mParticle.EventsApi(config, apiClient);\n\nvar affected_passengers = [];\n\nasync function audience_query(flight_no, departure_date) {\n\n    const query = 'SELECT customerid, mpid, firstname, lastname, gender, outbound_flight, outbound_departure_date, inbound_flight, inbound_departure_date FROM ops-8075.Views.view_departure WHERE (outbound_flight LIKE \\'' + flight_no + '%\\' AND outbound_departure_date LIKE \\'' + departure_date + '%\\') OR (inbound_flight LIKE ' +  '\\'' + flight_no + '%\\' AND inbound_departure_date LIKE \\'' + departure_date + '%\\')';\n\n    // For all options, see https://cloud.google.com/bigquery/docs/reference/rest/v2/jobs/query\n    const options = {\n        query: query,\n        // Location must match that of the dataset(s) referenced in the query.\n        location: 'US',\n    };\n\n    // Run the query as a job\n    const [job] = await bigquery.createQueryJob(options);\n\n    // Wait for the query to finish\n    const [rows] = await job.getQueryResults();\n\n    // Print the results\n    rows.forEach(row => affected_passengers.push(row));\n}\n\nflight_update.get('/', async function(req, res) {\n\n    await audience_query(req.query['flight'], req.query['departure_date']);\n    console.log('affected passgeners: ' + affected_passengers.length)\n\n    var batches = []\n    for (var i=0; i<affected_passengers.length; i++) {\n        var batch = new mParticle.Batch(mParticle.Batch.Environment.development);\n        batch.context = { \n            \"data_plan\": {\n                \"plan_id\": \"dp_example\",\n                \"plan_version\": 1\n            }\n        }\n        var user_identities = new mParticle.UserIdentities();\n    \n        user_identities.customerid = affected_passengers[i]['customerid'];\n        batch.user_identities = user_identities;\n        batch.mp_deviceid = '48ad4e3b-4137-4ed0-93db-69c896116767';\n    \n        var event = new mParticle.AppEvent(mParticle.AppEvent.CustomEventType.other, 'flight_update');\n        event.custom_attributes = {\n            \"Flight_No.\": affected_passengers[i]['outbound_flight'].indexOf(req.query['flight']) > -1 ? affected_passengers[i]['outbound_flight']:affected_passengers[i]['inbound_flight'],\n            \"Passenger\": affected_passengers[i]['gender'].indexOf('M') > -1 ? \"Mr. \" + affected_passengers[i]['firstname'] + \" \" + affected_passengers[i]['lastname'] : \"Mrs. \" + affected_passengers[i]['firstname'] + \" \" + affected_passengers[i]['lastname'],\n            \"Departure_Airport\": flights[req.query['flight']]['F-City'],\n            \"Arrival_Airport\": flights[req.query['flight']]['T-City'],\n            \"Departure_Time\": req.query['departure_date'] + \"T\" + flights[req.query['flight']]['F-Time'] + \":00+00:00\",\n            \"Delay_Time\": req.query['delay']\n        };\n  \n        batch.addEvent(event);\n        batches.push(batch);\n    }\n\n    if (affected_passengers.length > 0) {\n        var callback = function(error, data, response) {\n            if (error) {\n                res.send('Error: ' + error);\n            } else {\n                res.header(\"Content-Type\",'application/json');\n                res.send(JSON.stringify({\n                    \"Flight_No.\": req.query['flight'],\n                    \"Departure_Airport\": flights[req.query['flight']]['F-City'],\n                    \"Arrival_Airport\": flights[req.query['flight']]['T-City'],\n                    \"Departure_Time\": req.query['departure_date'] + \"T\" + flights[req.query['flight']]['F-Time'] + \":00+00:00\",\n                    \"Delay_Time\": req.query['delay']\n                }, null, 4));\n            }\n        }\n        api.bulkUploadEvents(batches, callback);\n    }\n    \n});\n\nmodule.exports = flight_update;"]}
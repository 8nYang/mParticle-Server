{"version":3,"sources":["public/mp/eJ_app.js","public/mp/check-in.js"],"names":["parse","require","fs","path","flights","flight_search","airport_code","eJ_flight_price","createReadStream","pipe","delimiter","from_line","on","row","error","console","log","message","module","exports","express","check_in","Router","mParticle","config","Configuration","apiClient","ApiClient","basePath","api","EventsApi","get","req","res","batch","Batch","Environment","development","context","user_identities","UserIdentities","customerid","query","mp_deviceid","event","AppEvent","CustomEventType","other","custom_attributes","Date","toISOString","split","addEvent","body","callback","data","response","send","header","JSON","stringify","bulkUploadEvents"],"mappings":"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","file":"check-in.js","sourceRoot":"../src","sourcesContent":["const { parse } = require(\"csv-parse\");\nconst fs = require('fs');\nconst path = require('path');\n\nvar flights = {}\nvar flight_search = {}\nvar airport_code = {}\n\nvar eJ_flight_price = {\n    \"Unit_Price\": 0.1,\n    \"Extra Legroom\": [0.3, 0.4],\n    \"Up Front\": [0.2, 0.3, 0.4],\n    \"Standard\": [0.0],\n    \"Standard Plus\": [0.3, 0.4],\n    \"Essentials\": [0.5, 0.6],\n    \"Large Cabin Bag\":[0.12, 0.25],\n    \"15kg Hold Bag\": [0.25, 0.35, 0.55],\n    \"23kg Hold Bag\": [0.45, 0.65],\n    \"26kg Hold Bag\": [0.4, 0.6],\n    \"Discount\": [0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.2, 0.25, 0.3, 0.35],\n    \"Inspire_Me_Type\": \"I don't mind|City explorer|Adventure and the great outdoors|Family holiday|Foodies|Going solo|Honeymoons and romance|Inspired by movies and TV|Instagram hotspots|Music and festivals|Off the beaten track|Sand sun and swim|Snow and slopes (and a little apres)\",\n    \"Inspire_Me_Trip\": \"Anytime|Summer-23|Autumn-23|Winter-23\",\n    \"Inspire_Me_Time\": \"One-Way|7d-Return|14d-Return|Weekend-Return\"\n}\n\nfs.createReadStream(\"/Users/hsyang/Downloads/eCommerce - webApp/mP-Media/src/public/mp/flights-details.txt\")\n    .pipe(parse({ delimiter: \",\", from_line: 2 }))\n    .on(\"data\", function (row) {\n        flights[row[0]] = {};\n        flights[row[0]]['F-IATA'] = row[1]\n        flights[row[0]]['F-City'] = row[2]\n        flights[row[0]]['F-Country'] = row[3]\n        flights[row[0]]['F-Terminal'] = row[4]\n        flights[row[0]]['F-Time'] = row[5]\n        flights[row[0]]['T-IATA'] = row[6]\n        flights[row[0]]['T-City'] = row[7]\n        flights[row[0]]['T-Country'] = row[8]\n        flights[row[0]]['T-Terminal'] = row[9]\n        flights[row[0]]['T-Time'] = row[10]\n        flights[row[0]]['Distance'] = row[11]\n        flights[row[0]]['Duration'] = row[12]\n        \n        airport_code[row[2]] = row[1]\n        \n        if (typeof flight_search[row[2]] == \"undefined\") {\n            flight_search[row[2]] = {}\n            if (typeof flight_search[row[2]][row[7]] == \"undefined\") {\n                flight_search[row[2]][row[7]] = {}\n            }\n        } else {\n            if (typeof flight_search[row[2]][row[7]] == \"undefined\") {\n                flight_search[row[2]][row[7]] = {}\n            }\n        }\n        flight_search[row[2]][row[7]][row[5]] = row[0]\n    })\n    .on(\"error\", function (error) {\n        console.log(error.message);\n    })\n    .on(\"end\", function () {\n        console.log(\"Done\");\n    });\n\nmodule.exports = {\n    flights: flights,\n    flight_search: flight_search,\n    airport_code: airport_code,\n    eJ_flight_price: eJ_flight_price\n}","'use strict'\n\nvar express = require('express');\nvar check_in = express.Router();\nvar mParticle = require('mparticle');\nconst {flights, flight_search, airport_code, eJ_flight_price} = require('./eJ_app.js');\n\n//https://demo.mp.com/mp/check_in?customerid=98760603&flight=EZY8105&departure_date=2023-06-21T06:30:00+00:00\n//mParticle Workshop ---> easyJet ---> Custom Feed ---> Levarti (Disruption)\nvar config = new mParticle.Configuration(\n    'us2-0de9a21b32cca340b649e7886c134428',\n    'hsVsm8K6ZEvD7J0XPrIrURMxpafHXf9niCIhz21q3-dsZrtUXSk5nmdSd2P_ME7m'\n);\nvar apiClient = new mParticle.ApiClient();\napiClient.basePath = 'https://s2s.us2.mparticle.com/v2';\nvar api = new mParticle.EventsApi(config, apiClient);\n\ncheck_in.get('/', function(req, res) {\n    \n    var batch = new mParticle.Batch(mParticle.Batch.Environment.development);\n    batch.context = { \n        \"data_plan\": {\n            \"plan_id\": \"dp_example\",\n            \"plan_version\": 1\n        }\n    }\n    var user_identities = new mParticle.UserIdentities();\n    \n    user_identities.customerid = req.query['customerid'];\n    batch.user_identities = user_identities;\n    batch.mp_deviceid = '48ad4e3b-4137-4ed0-93db-69c896116767';\n    \n    var event = new mParticle.AppEvent(mParticle.AppEvent.CustomEventType.other, 'flight_check_in');\n    event.custom_attributes = {\n        \"Flight_No.\": req.query['flight'],\n        \"Departure_Airport\": flights[req.query['flight']]['F-City'],\n        \"Arrival_Airport\": flights[req.query['flight']]['T-City'],\n        \"Departure_Time\": req.query['departure_date'],\n        \"Flight_Distance\": flights[req.query['flight']]['Distance'],\n        \"Flight_Duration\": flights[req.query['flight']]['Duration'],\n        \"Checkin_Time\": (new Date().toISOString().split(\".\")[0]+\"+00:00\")\n    };\n  \n    batch.addEvent(event);\n    \n    var body = [batch];\n    var callback = function(error, data, response) {\n        if (error) {\n            res.send('Error: ' + error);\n        } else {\n            res.header(\"Content-Type\",'application/json');\n            res.send(JSON.stringify({\n                'Checked-In': req.query['flight'],\n                'Distance': flights[req.query['flight']]['Distance'],\n                'Duration': flights[req.query['flight']]['Duration']\n            }, null, 4))\n        }\n    };\n\n    api.bulkUploadEvents(body, callback);\n    \n});\n\nmodule.exports = check_in;"]}
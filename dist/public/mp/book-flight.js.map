{"version":3,"sources":["public/mp/eJ_app.js","public/mp/book-flight.js"],"names":["parse","require","fs","path","flights","flight_search","airport_code","eJ_flight_price","createReadStream","pipe","delimiter","from_line","on","row","error","console","log","message","module","exports","express","book_flight","Router","mParticle","config","Configuration","apiClient","ApiClient","basePath","api","EventsApi","random_flight","from","to","matched","Object","keys","forEach","key","indexOf","push","from_city","random_choice","to_city","a_src","Math","floor","random","length","uuidv4","replace","c","r","v","toString","get","req","res","batch","Batch","Environment","development","context","user_identities","UserIdentities","customerid","query","mp_deviceid","outbound_flight","outbound_flight_distance","outbound_flight_duration","inbound_flight","inbound_flight_distance","inbound_flight_duration","quantity","curr_date_timestamp","Date","toISOString","split","getTime","days_ahead","trip_days","outbound_departure_timestamp","outbound_departure_date","outbound_arrival_timestamp","outbound_arrival_date","inbound_departure_timestamp","inbound_departure_date","inbound_arrival_timestamp","inbound_arrival_date","product_outbound_flight","Product","name","id","category","brand","price","round","custom_attributes","total_product_amount","product_outbound_flight_bundle","product_outbound_flight_seats","product_inbound_flight","product_inbound_flight_bundle","product_inbound_flight_seats","product_action","ProductAction","products","total_amount","tax_amount","transaction_id","commerce_event","CommerceEvent","timestamp_unixtime_ms","now","addEvent","body","callback","data","response","send","header","JSON","stringify","bulkUploadEvents"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAM;EAAEA;AAAF,IAAYC,OAAO,CAAC,WAAD,CAAzB;;AACA,MAAMC,EAAE,GAAGD,OAAO,CAAC,IAAD,CAAlB;;AACA,MAAME,IAAI,GAAGF,OAAO,CAAC,MAAD,CAApB;;AAEA,IAAIG,OAAO,GAAG,EAAd;AACA,IAAIC,aAAa,GAAG,EAApB;AACA,IAAIC,YAAY,GAAG,EAAnB;AAEA,IAAIC,eAAe,GAAG;EAClB,cAAc,GADI;EAElB,iBAAiB,CAAC,GAAD,EAAM,GAAN,CAFC;EAGlB,YAAY,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAHM;EAIlB,YAAY,CAAC,GAAD,CAJM;EAKlB,iBAAiB,CAAC,GAAD,EAAM,GAAN,CALC;EAMlB,cAAc,CAAC,GAAD,EAAM,GAAN,CANI;EAOlB,mBAAkB,CAAC,IAAD,EAAO,IAAP,CAPA;EAQlB,iBAAiB,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,CARC;EASlB,iBAAiB,CAAC,IAAD,EAAO,IAAP,CATC;EAUlB,iBAAiB,CAAC,GAAD,EAAM,GAAN,CAVC;EAWlB,YAAY,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,EAAyB,IAAzB,EAA+B,IAA/B,EAAqC,IAArC,EAA2C,GAA3C,EAAgD,IAAhD,EAAsD,GAAtD,EAA2D,IAA3D,CAXM;EAYlB,mBAAmB,mQAZD;EAalB,mBAAmB,uCAbD;EAclB,mBAAmB;AAdD,CAAtB;AAiBAL,EAAE,CAACM,gBAAH,CAAoB,uFAApB,EACKC,IADL,CACUT,KAAK,CAAC;EAAEU,SAAS,EAAE,GAAb;EAAkBC,SAAS,EAAE;AAA7B,CAAD,CADf,EAEKC,EAFL,CAEQ,MAFR,EAEgB,UAAUC,GAAV,EAAe;EACvBT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,GAAkB,EAAlB;EACAT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,CAAgB,QAAhB,IAA4BA,GAAG,CAAC,CAAD,CAA/B;EACAT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,CAAgB,QAAhB,IAA4BA,GAAG,CAAC,CAAD,CAA/B;EACAT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,CAAgB,WAAhB,IAA+BA,GAAG,CAAC,CAAD,CAAlC;EACAT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,CAAgB,YAAhB,IAAgCA,GAAG,CAAC,CAAD,CAAnC;EACAT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,CAAgB,QAAhB,IAA4BA,GAAG,CAAC,CAAD,CAA/B;EACAT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,CAAgB,QAAhB,IAA4BA,GAAG,CAAC,CAAD,CAA/B;EACAT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,CAAgB,QAAhB,IAA4BA,GAAG,CAAC,CAAD,CAA/B;EACAT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,CAAgB,WAAhB,IAA+BA,GAAG,CAAC,CAAD,CAAlC;EACAT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,CAAgB,YAAhB,IAAgCA,GAAG,CAAC,CAAD,CAAnC;EACAT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,CAAgB,QAAhB,IAA4BA,GAAG,CAAC,EAAD,CAA/B;EACAT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,CAAgB,UAAhB,IAA8BA,GAAG,CAAC,EAAD,CAAjC;EACAT,OAAO,CAACS,GAAG,CAAC,CAAD,CAAJ,CAAP,CAAgB,UAAhB,IAA8BA,GAAG,CAAC,EAAD,CAAjC;EAEAP,YAAY,CAACO,GAAG,CAAC,CAAD,CAAJ,CAAZ,GAAuBA,GAAG,CAAC,CAAD,CAA1B;;EAEA,IAAI,OAAOR,aAAa,CAACQ,GAAG,CAAC,CAAD,CAAJ,CAApB,IAAgC,WAApC,EAAiD;IAC7CR,aAAa,CAACQ,GAAG,CAAC,CAAD,CAAJ,CAAb,GAAwB,EAAxB;;IACA,IAAI,OAAOR,aAAa,CAACQ,GAAG,CAAC,CAAD,CAAJ,CAAb,CAAsBA,GAAG,CAAC,CAAD,CAAzB,CAAP,IAAwC,WAA5C,EAAyD;MACrDR,aAAa,CAACQ,GAAG,CAAC,CAAD,CAAJ,CAAb,CAAsBA,GAAG,CAAC,CAAD,CAAzB,IAAgC,EAAhC;IACH;EACJ,CALD,MAKO;IACH,IAAI,OAAOR,aAAa,CAACQ,GAAG,CAAC,CAAD,CAAJ,CAAb,CAAsBA,GAAG,CAAC,CAAD,CAAzB,CAAP,IAAwC,WAA5C,EAAyD;MACrDR,aAAa,CAACQ,GAAG,CAAC,CAAD,CAAJ,CAAb,CAAsBA,GAAG,CAAC,CAAD,CAAzB,IAAgC,EAAhC;IACH;EACJ;;EACDR,aAAa,CAACQ,GAAG,CAAC,CAAD,CAAJ,CAAb,CAAsBA,GAAG,CAAC,CAAD,CAAzB,EAA8BA,GAAG,CAAC,CAAD,CAAjC,IAAwCA,GAAG,CAAC,CAAD,CAA3C;AACH,CA9BL,EA+BKD,EA/BL,CA+BQ,OA/BR,EA+BiB,UAAUE,KAAV,EAAiB;EAC1BC,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACG,OAAlB;AACH,CAjCL,EAkCKL,EAlCL,CAkCQ,KAlCR,EAkCe,YAAY;EACnBG,OAAO,CAACC,GAAR,CAAY,MAAZ;AACH,CApCL;AAsCAE,MAAM,CAACC,OAAP,GAAiB;EACbf,OAAO,EAAEA,OADI;EAEbC,aAAa,EAAEA,aAFF;EAGbC,YAAY,EAAEA,YAHD;EAIbC,eAAe,EAAEA;AAJJ,CAAjB;;AC/DA,IAAIa,OAAO,GAAGnB,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIoB,WAAW,GAAGD,OAAO,CAACE,MAAR,EAAlB;;AACA,IAAIC,SAAS,GAAGtB,OAAO,CAAC,WAAD,CAAvB;;AACA,MAAM;EAACG,OAAD;EAAUC,aAAV;EAAyBC,YAAzB;EAAuCC;AAAvC,IAA0DN,OAAO,CAAC,aAAD,CAAvE,EAEA;AACA;;;AACA,IAAIuB,MAAM,GAAG,IAAID,SAAS,CAACE,aAAd,CACT,sCADS,EAET,kEAFS,CAAb,EAGI;AACA;;AACJ,IAAIC,SAAS,GAAG,IAAIH,SAAS,CAACI,SAAd,EAAhB;AACAD,SAAS,CAACE,QAAV,GAAqB,kCAArB;AACA,IAAIC,GAAG,GAAG,IAAIN,SAAS,CAACO,SAAd,CAAwBN,MAAxB,EAAgCE,SAAhC,CAAV;;AAEA,SAASK,aAAT,CAAuBC,IAAvB,EAA6B3B,aAA7B,EAA4C4B,EAAE,GAAC,EAA/C,EAAmD;EAE/C,IAAIC,OAAO,GAAG,EAAd;EACAC,MAAM,CAACC,IAAP,CAAY/B,aAAZ,EAA2BgC,OAA3B,CAAmCC,GAAG,IAAI;IACtC,IAAIA,GAAG,CAACC,OAAJ,CAAYP,IAAZ,KAAqB,CAAzB,EAA4B;MACxBE,OAAO,CAACM,IAAR,CAAaF,GAAb;IACH;EACJ,CAJD;EAKA,IAAIG,SAAS,GAAGC,aAAa,CAACR,OAAD,CAA7B;;EACA,IAAID,EAAE,IAAI,EAAV,EAAc;IACV,IAAIU,OAAO,GAAGD,aAAa,CAACP,MAAM,CAACC,IAAP,CAAY/B,aAAa,CAACoC,SAAD,CAAzB,CAAD,CAA3B;EACH,CAFD,MAEO;IACH,IAAIE,OAAO,GAAGV,EAAd;EACH;;EAED,OAAO5B,aAAa,CAACoC,SAAD,CAAb,CAAyBE,OAAzB,EAAkCD,aAAa,CAACP,MAAM,CAACC,IAAP,CAAY/B,aAAa,CAACoC,SAAD,CAAb,CAAyBE,OAAzB,CAAZ,CAAD,CAA/C,CAAP;AAEH;;AAED,SAASD,aAAT,CAAuBE,KAAvB,EAA8B;EAC1B,OAAOA,KAAK,CAACC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgBH,KAAK,CAACI,MAAjC,CAAD,CAAZ;AACH;;AAED,SAASC,MAAT,GAAkB;EACd,OAAO,uCAAuCC,OAAvC,CAA+C,OAA/C,EAAwD,UAASC,CAAT,EAAY;IACvE,IAAIC,CAAC,GAAGP,IAAI,CAACE,MAAL,KAAgB,EAAhB,GAAqB,CAA7B;IAAA,IAAgCM,CAAC,GAAGF,CAAC,IAAI,GAAL,GAAWC,CAAX,GAAgBA,CAAC,GAAG,GAAJ,GAAU,GAA9D;IACA,OAAOC,CAAC,CAACC,QAAF,CAAW,EAAX,CAAP;EACH,CAHM,CAAP;AAIH;;AAEDjC,WAAW,CAACkC,GAAZ,CAAgB,GAAhB,EAAqB,UAASC,GAAT,EAAcC,GAAd,EAAmB;EAEpC,IAAIC,KAAK,GAAG,IAAInC,SAAS,CAACoC,KAAd,CAAoBpC,SAAS,CAACoC,KAAV,CAAgBC,WAAhB,CAA4BC,WAAhD,CAAZ;EACAH,KAAK,CAACI,OAAN,GAAgB;IACZ,aAAa;MACT,WAAW,YADF;MAET,gBAAgB;IAFP;EADD,CAAhB;EAMA,IAAIC,eAAe,GAAG,IAAIxC,SAAS,CAACyC,cAAd,EAAtB;EAEAD,eAAe,CAACE,UAAhB,GAA6BT,GAAG,CAACU,KAAJ,CAAU,YAAV,CAA7B;EACAR,KAAK,CAACK,eAAN,GAAwBA,eAAxB;EACAL,KAAK,CAACS,WAAN,GAAoB,sCAApB;EAEA,IAAIC,eAAe,GAAGrC,aAAa,CAACyB,GAAG,CAACU,KAAJ,CAAU,MAAV,CAAD,EAAoB7D,aAApB,CAAnC;EACAU,OAAO,CAACC,GAAR,CAAY,eAAeoD,eAA3B;EACA,IAAIC,wBAAwB,GAAGjE,OAAO,CAACgE,eAAD,CAAP,CAAyB,UAAzB,CAA/B;EACA,IAAIE,wBAAwB,GAAGlE,OAAO,CAACgE,eAAD,CAAP,CAAyB,UAAzB,CAA/B;EACA,IAAIG,cAAc,GAAGxC,aAAa,CAAC3B,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,CAAD,EAAqC/D,aAArC,EAAoDD,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,CAApD,CAAlC;EACA,IAAII,uBAAuB,GAAGpE,OAAO,CAACmE,cAAD,CAAP,CAAwB,UAAxB,CAA9B;EACA,IAAIE,uBAAuB,GAAGrE,OAAO,CAACmE,cAAD,CAAP,CAAwB,UAAxB,CAA9B;EACA,IAAIG,QAAQ,GAAGhC,aAAa,CAAC,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAD,CAA5B;EAEA,IAAIiC,mBAAmB,GAAI,IAAIC,IAAJ,CAAS,IAAIA,IAAJ,GAAWC,WAAX,GAAyBC,KAAzB,CAA+B,GAA/B,EAAoC,CAApC,IAAuC,iBAAhD,CAAD,CAAqEC,OAArE,EAA1B;EACA,IAAIC,UAAU,GAAGnC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgB,EAA3B,IAAiC,CAAlD;EACA,IAAIkC,SAAS,GAAGvC,aAAa,CAAC,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,EAAV,EAAc,EAAd,CAAD,CAA7B;EACA,IAAIwC,4BAA4B,GAAGP,mBAAmB,GAAGK,UAAU,GAAG,KAAb,GAAqB,IAA9E;EACA,IAAIG,uBAAuB,GAAI,IAAIP,IAAJ,CAASM,4BAAT,EAAuCL,WAAvC,EAAD,CAAuDC,KAAvD,CAA6D,GAA7D,EAAkE,CAAlE,IAAqE,GAArE,GAAyE1E,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,CAAzE,GAA4G,WAA1I;EACA,IAAIgB,0BAA0B,GAAG,IAAIR,IAAJ,CAASO,uBAAT,EAAkCJ,OAAlC,KAA8C3E,OAAO,CAACgE,eAAD,CAAP,CAAyB,UAAzB,IAAuC,EAAvC,GAA4C,IAA3H;EACA,IAAIiB,qBAAqB,GAAI,IAAIT,IAAJ,CAASQ,0BAAT,EAAqCP,WAArC,EAAD,CAAqDC,KAArD,CAA2D,GAA3D,EAAgE,CAAhE,IAAmE,QAA/F;EACA,IAAIQ,2BAA2B,GAAGJ,4BAA4B,GAAGD,SAAS,GAAG,KAAZ,GAAoB,IAArF;EACA,IAAIM,sBAAsB,GAAI,IAAIX,IAAJ,CAASU,2BAAT,EAAsCT,WAAtC,EAAD,CAAsDC,KAAtD,CAA4D,GAA5D,EAAiE,CAAjE,IAAoE,GAApE,GAAwE1E,OAAO,CAACmE,cAAD,CAAP,CAAwB,QAAxB,CAAxE,GAA0G,WAAvI;EACA,IAAIiB,yBAAyB,GAAG,IAAIZ,IAAJ,CAASW,sBAAT,EAAiCR,OAAjC,KAA6C3E,OAAO,CAACmE,cAAD,CAAP,CAAwB,UAAxB,IAAsC,EAAtC,GAA2C,IAAxH;EACA,IAAIkB,oBAAoB,GAAI,IAAIb,IAAJ,CAASY,yBAAT,EAAoCX,WAApC,EAAD,CAAoDC,KAApD,CAA0D,GAA1D,EAA+D,CAA/D,IAAkE,QAA7F;EAEA,IAAIY,uBAAuB,GAAG,IAAInE,SAAS,CAACoE,OAAd,EAA9B;EACAD,uBAAuB,CAACE,IAAxB,GAA+B,iBAA/B;EACAF,uBAAuB,CAACG,EAAxB,GAA6BzB,eAAe,GAAG,GAAlB,GAAwBhE,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,CAAxB,GAA6D,GAA7D,GAAmEhE,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,CAAhG;EACAsB,uBAAuB,CAACI,QAAxB,GAAmC,SAAnC;EACAJ,uBAAuB,CAACK,KAAxB,GAAgC,SAAhC;EACAL,uBAAuB,CAAChB,QAAxB,GAAmCA,QAAnC;EACAgB,uBAAuB,CAACM,KAAxB,GAAgC5F,OAAO,CAACgE,eAAD,CAAP,CAAyB,UAAzB,IAAuC1B,aAAa,CAACnC,eAAe,CAAC,UAAD,CAAhB,CAApF;EACAmF,uBAAuB,CAACM,KAAxB,GAAgCnD,IAAI,CAACoD,KAAL,CAAWP,uBAAuB,CAACM,KAAxB,GAAgC,GAA3C,IAAkD,GAAlF;EACAN,uBAAuB,CAACQ,iBAAxB,GAA4C,EAA5C;EACAR,uBAAuB,CAACQ,iBAAxB,CAA0C,MAA1C,IAAoD9F,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,IAAqC,KAArC,GAA6ChE,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,CAAjG;EACAsB,uBAAuB,CAACQ,iBAAxB,CAA0C,IAA1C,IAAkD9F,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,IAAqC,KAArC,GAA6ChE,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,CAA/F;EACAsB,uBAAuB,CAACQ,iBAAxB,CAA0C,iBAA1C,IAA+D7B,wBAA/D;EACAqB,uBAAuB,CAACQ,iBAAxB,CAA0C,iBAA1C,IAA+D5B,wBAA/D;EACAoB,uBAAuB,CAACQ,iBAAxB,CAA0C,gBAA1C,IAA8Df,uBAA9D;EACAO,uBAAuB,CAACQ,iBAAxB,CAA0C,cAA1C,IAA4Db,qBAA5D;EACAK,uBAAuB,CAACS,oBAAxB,GAA+CtD,IAAI,CAACoD,KAAL,CAAWP,uBAAuB,CAACM,KAAxB,GAAgCN,uBAAuB,CAAChB,QAAxD,GAAmE,GAA9E,IAAqF,GAApI;EAEA,IAAI0B,8BAA8B,GAAG,IAAI7E,SAAS,CAACoE,OAAd,EAArC;EACAS,8BAA8B,CAACR,IAA/B,GAAsC,wBAAtC;EACAQ,8BAA8B,CAACP,EAA/B,GAAoC,eAApC;EACAO,8BAA8B,CAACN,QAA/B,GAA0C,SAA1C;EACAM,8BAA8B,CAACL,KAA/B,GAAuC,SAAvC;EACAK,8BAA8B,CAAC1B,QAA/B,GAA0CA,QAA1C;EACA0B,8BAA8B,CAACF,iBAA/B,GAAmD,EAAnD;EACAE,8BAA8B,CAACF,iBAA/B,CAAiD,QAAjD,IAA6DxD,aAAa,CAAC,CAAC,UAAD,EAAa,eAAb,EAA8B,YAA9B,CAAD,CAA1E;EACA0D,8BAA8B,CAACJ,KAA/B,GAAuCN,uBAAuB,CAACM,KAAxB,GAAgCtD,aAAa,CAACnC,eAAe,CAAC6F,8BAA8B,CAACF,iBAA/B,CAAiD,QAAjD,CAAD,CAAhB,CAApF;EACAE,8BAA8B,CAACJ,KAA/B,GAAuCnD,IAAI,CAACoD,KAAL,CAAWG,8BAA8B,CAACJ,KAA/B,GAAuC,GAAlD,IAAyD,GAAhG;EACAI,8BAA8B,CAACD,oBAA/B,GAAsDtD,IAAI,CAACoD,KAAL,CAAWG,8BAA8B,CAACJ,KAA/B,GAAuCI,8BAA8B,CAAC1B,QAAtE,GAAiF,GAA5F,IAAmG,GAAzJ;EAEA,IAAI2B,6BAA6B,GAAG,IAAI9E,SAAS,CAACoE,OAAd,EAApC;EACAU,6BAA6B,CAACT,IAA9B,GAAqC,uBAArC;EACAS,6BAA6B,CAACR,EAA9B,GAAmC,cAAnC;EACAQ,6BAA6B,CAACP,QAA9B,GAAyC,OAAzC;EACAO,6BAA6B,CAACN,KAA9B,GAAsC,SAAtC;EACAM,6BAA6B,CAAC3B,QAA9B,GAAyCA,QAAzC;EACA2B,6BAA6B,CAACH,iBAA9B,GAAkD,EAAlD;EACAG,6BAA6B,CAACH,iBAA9B,CAAgD,WAAhD,IAA+DxD,aAAa,CAAC,CAAC,eAAD,EAAkB,UAAlB,EAA8B,UAA9B,CAAD,CAA5E;EACA2D,6BAA6B,CAACL,KAA9B,GAAsCN,uBAAuB,CAACM,KAAxB,GAAgCtD,aAAa,CAACnC,eAAe,CAAC8F,6BAA6B,CAACH,iBAA9B,CAAgD,WAAhD,CAAD,CAAhB,CAAnF;EACAG,6BAA6B,CAACL,KAA9B,GAAsCnD,IAAI,CAACoD,KAAL,CAAWI,6BAA6B,CAACL,KAA9B,GAAsC,GAAjD,IAAwD,GAA9F;EACAK,6BAA6B,CAACF,oBAA9B,GAAqDtD,IAAI,CAACoD,KAAL,CAAWI,6BAA6B,CAACL,KAA9B,GAAsCK,6BAA6B,CAAC3B,QAApE,GAA+E,GAA1F,IAAiG,GAAtJ;EAEA,IAAI4B,sBAAsB,GAAG,IAAI/E,SAAS,CAACoE,OAAd,EAA7B;EACAW,sBAAsB,CAACV,IAAvB,GAA8B,gBAA9B;EACAU,sBAAsB,CAACT,EAAvB,GAA4BtB,cAAc,GAAG,GAAjB,GAAuBnE,OAAO,CAACmE,cAAD,CAAP,CAAwB,QAAxB,CAAvB,GAA2D,GAA3D,GAAiEnE,OAAO,CAACmE,cAAD,CAAP,CAAwB,QAAxB,CAA7F;EACA+B,sBAAsB,CAACR,QAAvB,GAAkC,SAAlC;EACAQ,sBAAsB,CAACP,KAAvB,GAA+B,SAA/B;EACAO,sBAAsB,CAAC5B,QAAvB,GAAkCA,QAAlC;EACA4B,sBAAsB,CAACN,KAAvB,GAA+B5F,OAAO,CAACmE,cAAD,CAAP,CAAwB,UAAxB,IAAsC7B,aAAa,CAACnC,eAAe,CAAC,UAAD,CAAhB,CAAlF;EACA+F,sBAAsB,CAACN,KAAvB,GAA+BnD,IAAI,CAACoD,KAAL,CAAWK,sBAAsB,CAACN,KAAvB,GAA+B,GAA1C,IAAiD,GAAhF;EACAM,sBAAsB,CAACJ,iBAAvB,GAA2C,EAA3C;EACAI,sBAAsB,CAACJ,iBAAvB,CAAyC,MAAzC,IAAmD9F,OAAO,CAACmE,cAAD,CAAP,CAAwB,QAAxB,IAAoC,KAApC,GAA4CnE,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,CAA/F;EACAkC,sBAAsB,CAACJ,iBAAvB,CAAyC,IAAzC,IAAiD9F,OAAO,CAACmE,cAAD,CAAP,CAAwB,QAAxB,IAAoC,KAApC,GAA4CnE,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,CAA7F;EACAkC,sBAAsB,CAACJ,iBAAvB,CAAyC,iBAAzC,IAA8D1B,uBAA9D;EACA8B,sBAAsB,CAACJ,iBAAvB,CAAyC,iBAAzC,IAA8DzB,uBAA9D;EACA6B,sBAAsB,CAACJ,iBAAvB,CAAyC,gBAAzC,IAA6DX,sBAA7D;EACAe,sBAAsB,CAACJ,iBAAvB,CAAyC,cAAzC,IAA2DT,oBAA3D;EACAa,sBAAsB,CAACH,oBAAvB,GAA8CtD,IAAI,CAACoD,KAAL,CAAWK,sBAAsB,CAACN,KAAvB,GAA+BM,sBAAsB,CAAC5B,QAAtD,GAAiE,GAA5E,IAAmF,GAAjI;EAEA,IAAI6B,6BAA6B,GAAG,IAAIhF,SAAS,CAACoE,OAAd,EAApC;EACAY,6BAA6B,CAACX,IAA9B,GAAqC,uBAArC;EACAW,6BAA6B,CAACV,EAA9B,GAAmC,eAAnC;EACAU,6BAA6B,CAACT,QAA9B,GAAyC,SAAzC;EACAS,6BAA6B,CAACR,KAA9B,GAAsC,SAAtC;EACAQ,6BAA6B,CAAC7B,QAA9B,GAAyCA,QAAzC;EACA6B,6BAA6B,CAACL,iBAA9B,GAAkD,EAAlD;EACAK,6BAA6B,CAACL,iBAA9B,CAAgD,QAAhD,IAA4DxD,aAAa,CAAC,CAAC,UAAD,EAAa,eAAb,EAA8B,YAA9B,CAAD,CAAzE;EACA6D,6BAA6B,CAACP,KAA9B,GAAsCM,sBAAsB,CAACN,KAAvB,GAA+BtD,aAAa,CAACnC,eAAe,CAACgG,6BAA6B,CAACL,iBAA9B,CAAgD,QAAhD,CAAD,CAAhB,CAAlF;EACAK,6BAA6B,CAACP,KAA9B,GAAsCnD,IAAI,CAACoD,KAAL,CAAWM,6BAA6B,CAACP,KAA9B,GAAsC,GAAjD,IAAwD,GAA9F;EACAO,6BAA6B,CAACJ,oBAA9B,GAAqDtD,IAAI,CAACoD,KAAL,CAAWM,6BAA6B,CAACP,KAA9B,GAAsCO,6BAA6B,CAAC7B,QAApE,GAA+E,GAA1F,IAAiG,GAAtJ;EAEA,IAAI8B,4BAA4B,GAAG,IAAIjF,SAAS,CAACoE,OAAd,EAAnC;EACAa,4BAA4B,CAACZ,IAA7B,GAAoC,sBAApC;EACAY,4BAA4B,CAACX,EAA7B,GAAkC,cAAlC;EACAW,4BAA4B,CAACV,QAA7B,GAAwC,OAAxC;EACAU,4BAA4B,CAACT,KAA7B,GAAqC,SAArC;EACAS,4BAA4B,CAAC9B,QAA7B,GAAwCA,QAAxC;EACA8B,4BAA4B,CAACN,iBAA7B,GAAiD,EAAjD;EACAM,4BAA4B,CAACN,iBAA7B,CAA+C,WAA/C,IAA8DxD,aAAa,CAAC,CAAC,eAAD,EAAkB,UAAlB,EAA8B,UAA9B,CAAD,CAA3E;EACA8D,4BAA4B,CAACR,KAA7B,GAAqCM,sBAAsB,CAACN,KAAvB,GAA+BtD,aAAa,CAACnC,eAAe,CAACiG,4BAA4B,CAACN,iBAA7B,CAA+C,WAA/C,CAAD,CAAhB,CAAjF;EACAM,4BAA4B,CAACR,KAA7B,GAAqCnD,IAAI,CAACoD,KAAL,CAAWO,4BAA4B,CAACR,KAA7B,GAAqC,GAAhD,IAAuD,GAA5F;EACAQ,4BAA4B,CAACL,oBAA7B,GAAoDtD,IAAI,CAACoD,KAAL,CAAWO,4BAA4B,CAACR,KAA7B,GAAqCQ,4BAA4B,CAAC9B,QAAlE,GAA6E,GAAxF,IAA+F,GAAnJ;EAEA,IAAI+B,cAAc,GAAG,IAAIlF,SAAS,CAACmF,aAAd,CAA4B,UAA5B,CAArB;EACAD,cAAc,CAACE,QAAf,GAA0B,CAACjB,uBAAD,EAA0BU,8BAA1B,EAA0DC,6BAA1D,EAAyFC,sBAAzF,EAAiHC,6BAAjH,EAAgJC,4BAAhJ,CAA1B;EAEAC,cAAc,CAACG,YAAf,GAA8BlB,uBAAuB,CAACS,oBAAxB,GAA+CC,8BAA8B,CAACD,oBAA9E,GAAqGE,6BAA6B,CAACF,oBAAnI,GAA0JG,sBAAsB,CAACH,oBAAjL,GAAwMI,6BAA6B,CAACJ,oBAAtO,GAC9BK,4BAA4B,CAACL,oBAD7B;EAEAM,cAAc,CAACI,UAAf,GAA4BhE,IAAI,CAACoD,KAAL,CAAWQ,cAAc,CAACG,YAAf,GAA8B,GAA9B,GAAoC,GAA/C,IAAsD,GAAlF;EAEAH,cAAc,CAACK,cAAf,GAAgC,eAAe7D,MAAM,EAArD;EAEA,IAAI8D,cAAc,GAAG,IAAIxF,SAAS,CAACyF,aAAd,EAArB;EACAD,cAAc,CAACN,cAAf,GAAgCA,cAAhC;EACAM,cAAc,CAACE,qBAAf,GAAuCrC,IAAI,CAACsC,GAAL,EAAvC,CAjIoC,CAiIe;;EAEnDxD,KAAK,CAACyD,QAAN,CAAeJ,cAAf;EAEA,IAAIK,IAAI,GAAG,CAAC1D,KAAD,CAAX;;EACA,IAAI2D,QAAQ,GAAG,UAASvG,KAAT,EAAgBwG,IAAhB,EAAsBC,QAAtB,EAAgC;IAC3C,IAAIzG,KAAJ,EAAW;MACP2C,GAAG,CAAC+D,IAAJ,CAAS,YAAY1G,KAArB;IACH,CAFD,MAEO;MACH2C,GAAG,CAACgE,MAAJ,CAAW,cAAX,EAA0B,kBAA1B;MACAhE,GAAG,CAAC+D,IAAJ,CAASE,IAAI,CAACC,SAAL,CAAe;QACpB,mBAAmBvD,eADC;QAEpB,2BAA2BhE,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,CAFP;QAGpB,mCAAmChE,OAAO,CAACgE,eAAD,CAAP,CAAyB,QAAzB,CAHf;QAIpB,kCAAkCe;MAJd,CAAf,EAKN,IALM,EAKA,CALA,CAAT;IAMH;EACJ,CAZD;;EAcAtD,GAAG,CAAC+F,gBAAJ,CAAqBR,IAArB,EAA2BC,QAA3B;AAEH,CAtJD;AAwJAnG,MAAM,CAACC,OAAP,GAAiBE,WAAjB","file":"book-flight.js","sourceRoot":"../src","sourcesContent":["const { parse } = require(\"csv-parse\");\nconst fs = require('fs');\nconst path = require('path');\n\nvar flights = {}\nvar flight_search = {}\nvar airport_code = {}\n\nvar eJ_flight_price = {\n    \"Unit_Price\": 0.1,\n    \"Extra Legroom\": [0.3, 0.4],\n    \"Up Front\": [0.2, 0.3, 0.4],\n    \"Standard\": [0.0],\n    \"Standard Plus\": [0.3, 0.4],\n    \"Essentials\": [0.5, 0.6],\n    \"Large Cabin Bag\":[0.12, 0.25],\n    \"15kg Hold Bag\": [0.25, 0.35, 0.55],\n    \"23kg Hold Bag\": [0.45, 0.65],\n    \"26kg Hold Bag\": [0.4, 0.6],\n    \"Discount\": [0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.2, 0.25, 0.3, 0.35],\n    \"Inspire_Me_Type\": \"I don't mind|City explorer|Adventure and the great outdoors|Family holiday|Foodies|Going solo|Honeymoons and romance|Inspired by movies and TV|Instagram hotspots|Music and festivals|Off the beaten track|Sand sun and swim|Snow and slopes (and a little apres)\",\n    \"Inspire_Me_Trip\": \"Anytime|Summer-23|Autumn-23|Winter-23\",\n    \"Inspire_Me_Time\": \"One-Way|7d-Return|14d-Return|Weekend-Return\"\n}\n\nfs.createReadStream(\"/Users/hsyang/Downloads/eCommerce - webApp/mP-Media/src/public/mp/flights-details.txt\")\n    .pipe(parse({ delimiter: \",\", from_line: 2 }))\n    .on(\"data\", function (row) {\n        flights[row[0]] = {};\n        flights[row[0]]['F-IATA'] = row[1]\n        flights[row[0]]['F-City'] = row[2]\n        flights[row[0]]['F-Country'] = row[3]\n        flights[row[0]]['F-Terminal'] = row[4]\n        flights[row[0]]['F-Time'] = row[5]\n        flights[row[0]]['T-IATA'] = row[6]\n        flights[row[0]]['T-City'] = row[7]\n        flights[row[0]]['T-Country'] = row[8]\n        flights[row[0]]['T-Terminal'] = row[9]\n        flights[row[0]]['T-Time'] = row[10]\n        flights[row[0]]['Distance'] = row[11]\n        flights[row[0]]['Duration'] = row[12]\n        \n        airport_code[row[2]] = row[1]\n        \n        if (typeof flight_search[row[2]] == \"undefined\") {\n            flight_search[row[2]] = {}\n            if (typeof flight_search[row[2]][row[7]] == \"undefined\") {\n                flight_search[row[2]][row[7]] = {}\n            }\n        } else {\n            if (typeof flight_search[row[2]][row[7]] == \"undefined\") {\n                flight_search[row[2]][row[7]] = {}\n            }\n        }\n        flight_search[row[2]][row[7]][row[5]] = row[0]\n    })\n    .on(\"error\", function (error) {\n        console.log(error.message);\n    })\n    .on(\"end\", function () {\n        console.log(\"Done\");\n    });\n\nmodule.exports = {\n    flights: flights,\n    flight_search: flight_search,\n    airport_code: airport_code,\n    eJ_flight_price: eJ_flight_price\n}","var express = require('express');\nvar book_flight = express.Router();\nvar mParticle = require('mparticle');\nconst {flights, flight_search, airport_code, eJ_flight_price} = require('./eJ_app.js');\n\n//https://demo.mp.com/mp/book_flight?customerid=98760614&from=London\n//mParticle Workshop ---> easyJet ---> Custom Feed ---> eRes System\nvar config = new mParticle.Configuration(\n    'us2-65576bc2bf1ec449bae46934f5e63182',\n    'lgWE_Irbh7hHA9VWJbX0jZr69W893eLs6I2kOI5gtDtvbsQ3zLuG_AaEOilt62W_');\n    //'us2-44914446e4bbc344892d3a67603d31b1',\n    //'TAZJMsciCeApddVJvK-BJq7PfNcOlxVlIEDk_SZQFYwiJVDGRC-Oag9PduYHNdND');\nvar apiClient = new mParticle.ApiClient()\napiClient.basePath = 'https://s2s.us2.mparticle.com/v2'\nvar api = new mParticle.EventsApi(config, apiClient);\n\nfunction random_flight(from, flight_search, to=\"\") {\n    \n    var matched = [];\n    Object.keys(flight_search).forEach(key => {\n        if (key.indexOf(from) >= 0) {\n            matched.push(key);\n        }\n    });\n    var from_city = random_choice(matched)\n    if (to == \"\") {\n        var to_city = random_choice(Object.keys(flight_search[from_city]))\n    } else {\n        var to_city = to\n    }\n    \n    return flight_search[from_city][to_city][random_choice(Object.keys(flight_search[from_city][to_city]))]\n    \n}\n\nfunction random_choice(a_src) {\n    return a_src[Math.floor(Math.random() * a_src.length)];\n}\n\nfunction uuidv4() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\n\nbook_flight.get('/', function(req, res) {\n    \n    var batch = new mParticle.Batch(mParticle.Batch.Environment.development);\n    batch.context = { \n        \"data_plan\": {\n            \"plan_id\": \"dp_example\",\n            \"plan_version\": 1\n        }\n    }\n    var user_identities = new mParticle.UserIdentities();\n    \n    user_identities.customerid = req.query['customerid']\n    batch.user_identities = user_identities;\n    batch.mp_deviceid = \"87d2ebaa-e956-407e-a1e6-f05f871bf4e6\"\n    \n    var outbound_flight = random_flight(req.query['from'], flight_search);\n    console.log(\"Outbound: \" + outbound_flight)\n    var outbound_flight_distance = flights[outbound_flight]['Distance']\n    var outbound_flight_duration = flights[outbound_flight]['Duration']\n    var inbound_flight = random_flight(flights[outbound_flight]['T-City'], flight_search, flights[outbound_flight]['F-City']);\n    var inbound_flight_distance = flights[inbound_flight]['Distance']\n    var inbound_flight_duration = flights[inbound_flight]['Duration']\n    var quantity = random_choice([1, 2, 3, 4])\n    \n    var curr_date_timestamp = (new Date(new Date().toISOString().split(\"T\")[0]+\"T00:00:00+00:00\")).getTime()\n    var days_ahead = Math.floor(Math.random() * 10) + 1;\n    var trip_days = random_choice([3, 5, 7, 10, 14])\n    var outbound_departure_timestamp = curr_date_timestamp + days_ahead * 86400 * 1000\n    var outbound_departure_date = (new Date(outbound_departure_timestamp).toISOString()).split(\"T\")[0]+\"T\"+flights[outbound_flight]['F-Time']+\":00+00:00\"\n    var outbound_arrival_timestamp = new Date(outbound_departure_date).getTime() + flights[outbound_flight]['Duration'] * 60 * 1000\n    var outbound_arrival_date = (new Date(outbound_arrival_timestamp).toISOString()).split(\".\")[0]+\"+00:00\"\n    var inbound_departure_timestamp = outbound_departure_timestamp + trip_days * 86400 * 1000\n    var inbound_departure_date = (new Date(inbound_departure_timestamp).toISOString()).split(\"T\")[0]+\"T\"+flights[inbound_flight]['F-Time']+\":00+00:00\"\n    var inbound_arrival_timestamp = new Date(inbound_departure_date).getTime() + flights[inbound_flight]['Duration'] * 60 * 1000\n    var inbound_arrival_date = (new Date(inbound_arrival_timestamp).toISOString()).split(\".\")[0]+\"+00:00\"   \n    \n    var product_outbound_flight = new mParticle.Product();\n    product_outbound_flight.name = 'Outbound Flight';\n    product_outbound_flight.id = outbound_flight + '-' + flights[outbound_flight]['F-IATA'] + '-' + flights[outbound_flight]['T-IATA'];\n    product_outbound_flight.category = \"Flights\"\n    product_outbound_flight.brand = \"easyJet\"\n    product_outbound_flight.quantity = quantity\n    product_outbound_flight.price = flights[outbound_flight]['Distance'] * random_choice(eJ_flight_price['Discount']);\n    product_outbound_flight.price = Math.round(product_outbound_flight.price * 100) / 100\n    product_outbound_flight.custom_attributes = {}\n    product_outbound_flight.custom_attributes['From'] = flights[outbound_flight]['F-City'] + \" - \" + flights[outbound_flight]['F-IATA']\n    product_outbound_flight.custom_attributes['To'] = flights[outbound_flight]['T-City'] + \" - \" + flights[outbound_flight]['T-IATA']\n    product_outbound_flight.custom_attributes['Flight_Distance'] = outbound_flight_distance\n    product_outbound_flight.custom_attributes['Flight_Duration'] = outbound_flight_duration\n    product_outbound_flight.custom_attributes['Departure_Time'] = outbound_departure_date\n    product_outbound_flight.custom_attributes['Arrival_Time'] = outbound_arrival_date\n    product_outbound_flight.total_product_amount = Math.round(product_outbound_flight.price * product_outbound_flight.quantity * 100) / 100\n    \n    var product_outbound_flight_bundle = new mParticle.Product();\n    product_outbound_flight_bundle.name = 'Outbound Flight Bundle';\n    product_outbound_flight_bundle.id = \"Flight Bundle\"\n    product_outbound_flight_bundle.category = \"Bundles\"\n    product_outbound_flight_bundle.brand = \"easyJet\"\n    product_outbound_flight_bundle.quantity = quantity\n    product_outbound_flight_bundle.custom_attributes = {}\n    product_outbound_flight_bundle.custom_attributes['Bundle'] = random_choice([\"Standard\", \"Standard Plus\", \"Essentials\"])\n    product_outbound_flight_bundle.price = product_outbound_flight.price * random_choice(eJ_flight_price[product_outbound_flight_bundle.custom_attributes['Bundle']])\n    product_outbound_flight_bundle.price = Math.round(product_outbound_flight_bundle.price * 100) / 100\n    product_outbound_flight_bundle.total_product_amount = Math.round(product_outbound_flight_bundle.price * product_outbound_flight_bundle.quantity * 100) / 100\n    \n    var product_outbound_flight_seats = new mParticle.Product();\n    product_outbound_flight_seats.name = 'Outbound Flight Seats';\n    product_outbound_flight_seats.id = \"Flight Seats\"\n    product_outbound_flight_seats.category = \"Seats\"\n    product_outbound_flight_seats.brand = \"easyJet\"\n    product_outbound_flight_seats.quantity = quantity\n    product_outbound_flight_seats.custom_attributes = {}\n    product_outbound_flight_seats.custom_attributes['Seat_Type'] = random_choice([\"Extra Legroom\", \"Up Front\", \"Standard\"])\n    product_outbound_flight_seats.price = product_outbound_flight.price * random_choice(eJ_flight_price[product_outbound_flight_seats.custom_attributes['Seat_Type']])\n    product_outbound_flight_seats.price = Math.round(product_outbound_flight_seats.price * 100) / 100\n    product_outbound_flight_seats.total_product_amount = Math.round(product_outbound_flight_seats.price * product_outbound_flight_seats.quantity * 100) / 100\n\n    var product_inbound_flight = new mParticle.Product();\n    product_inbound_flight.name = 'Inbound Flight';\n    product_inbound_flight.id = inbound_flight + '-' + flights[inbound_flight]['F-IATA'] + '-' + flights[inbound_flight]['T-IATA'];\n    product_inbound_flight.category = \"Flights\"\n    product_inbound_flight.brand = \"easyJet\"\n    product_inbound_flight.quantity = quantity\n    product_inbound_flight.price = flights[inbound_flight]['Distance'] * random_choice(eJ_flight_price['Discount']);\n    product_inbound_flight.price = Math.round(product_inbound_flight.price * 100) / 100\n    product_inbound_flight.custom_attributes = {}\n    product_inbound_flight.custom_attributes['From'] = flights[inbound_flight]['F-City'] + \" - \" + flights[outbound_flight]['F-IATA']\n    product_inbound_flight.custom_attributes['To'] = flights[inbound_flight]['T-City'] + \" - \" + flights[outbound_flight]['T-IATA']\n    product_inbound_flight.custom_attributes['Flight_Distance'] = inbound_flight_distance\n    product_inbound_flight.custom_attributes['Flight_Duration'] = inbound_flight_duration\n    product_inbound_flight.custom_attributes['Departure_Time'] = inbound_departure_date\n    product_inbound_flight.custom_attributes['Arrival_Time'] = inbound_arrival_date\n    product_inbound_flight.total_product_amount = Math.round(product_inbound_flight.price * product_inbound_flight.quantity * 100) / 100\n    \n    var product_inbound_flight_bundle = new mParticle.Product();\n    product_inbound_flight_bundle.name = 'Inbound Flight Bundle';\n    product_inbound_flight_bundle.id = \"Flight Bundle\"\n    product_inbound_flight_bundle.category = \"Bundles\"\n    product_inbound_flight_bundle.brand = \"easyJet\"\n    product_inbound_flight_bundle.quantity = quantity\n    product_inbound_flight_bundle.custom_attributes = {}\n    product_inbound_flight_bundle.custom_attributes['Bundle'] = random_choice([\"Standard\", \"Standard Plus\", \"Essentials\"])\n    product_inbound_flight_bundle.price = product_inbound_flight.price * random_choice(eJ_flight_price[product_inbound_flight_bundle.custom_attributes['Bundle']])\n    product_inbound_flight_bundle.price = Math.round(product_inbound_flight_bundle.price * 100) / 100\n    product_inbound_flight_bundle.total_product_amount = Math.round(product_inbound_flight_bundle.price * product_inbound_flight_bundle.quantity * 100) / 100\n    \n    var product_inbound_flight_seats = new mParticle.Product();\n    product_inbound_flight_seats.name = 'Inbound Flight Seats';\n    product_inbound_flight_seats.id = \"Flight Seats\"\n    product_inbound_flight_seats.category = \"Seats\"\n    product_inbound_flight_seats.brand = \"easyJet\"\n    product_inbound_flight_seats.quantity = quantity\n    product_inbound_flight_seats.custom_attributes = {}\n    product_inbound_flight_seats.custom_attributes['Seat_Type'] = random_choice([\"Extra Legroom\", \"Up Front\", \"Standard\"])\n    product_inbound_flight_seats.price = product_inbound_flight.price * random_choice(eJ_flight_price[product_inbound_flight_seats.custom_attributes['Seat_Type']])\n    product_inbound_flight_seats.price = Math.round(product_inbound_flight_seats.price * 100) / 100\n    product_inbound_flight_seats.total_product_amount = Math.round(product_inbound_flight_seats.price * product_inbound_flight_seats.quantity * 100) / 100\n    \n    var product_action = new mParticle.ProductAction('purchase');\n    product_action.products = [product_outbound_flight, product_outbound_flight_bundle, product_outbound_flight_seats, product_inbound_flight, product_inbound_flight_bundle, product_inbound_flight_seats];\n    \n    product_action.total_amount = product_outbound_flight.total_product_amount + product_outbound_flight_bundle.total_product_amount + product_outbound_flight_seats.total_product_amount + product_inbound_flight.total_product_amount + product_inbound_flight_bundle.total_product_amount +\n    product_inbound_flight_seats.total_product_amount;\n    product_action.tax_amount = Math.round(product_action.total_amount * 0.2 * 100) / 100;\n    \n    product_action.transaction_id = \"eJ-Mobile-\" + uuidv4();\n\n    var commerce_event = new mParticle.CommerceEvent();\n    commerce_event.product_action = product_action;\n    commerce_event.timestamp_unixtime_ms = Date.now(); //replace with time of transaction\n\n    batch.addEvent(commerce_event);\n    \n    var body = [batch]\n    var callback = function(error, data, response) {\n        if (error) {\n            res.send('Error: ' + error);\n        } else {\n            res.header(\"Content-Type\",'application/json');\n            res.send(JSON.stringify({\n                'Outbound_Flight': outbound_flight,\n                'Outbound_Flight_Airport': flights[outbound_flight]['F-City'],\n                'Outbound_Flight_Arrival_Airport': flights[outbound_flight]['T-City'],\n                'Outbound_Flight_Departure_Date': outbound_departure_date\n            }, null, 4));\n        }\n    };\n\n    api.bulkUploadEvents(body, callback);\n\n});\n\nmodule.exports = book_flight;"]}
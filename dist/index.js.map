{"version":3,"sources":["public/mp/eJ_app.js","public/mp/book-flight.js","public/mp/check-in.js","public/mp/flight-update.js","public/mp/buy-coin.js","public/mp/buy-matas.js","public/mp/buy-puc.js","public/mp/push-notification.js","public/mp/profile.js","app.js","index.js"],"names":["parse","require","fs","path","flights","flight_search","airport_code","eJ_flight_price","createReadStream","pipe","delimiter","from_line","on","row","error","console","log","message","module","exports","express","book_flight","Router","mParticle","config","Configuration","apiClient","ApiClient","basePath","api","EventsApi","random_flight","from","to","matched","Object","keys","forEach","key","indexOf","push","from_city","random_choice","to_city","a_src","Math","floor","random","length","uuidv4","replace","c","r","v","toString","get","req","res","batch","Batch","Environment","development","context","user_identities","UserIdentities","customerid","query","mp_deviceid","outbound_flight","outbound_flight_distance","outbound_flight_duration","inbound_flight","inbound_flight_distance","inbound_flight_duration","quantity","curr_date_timestamp","Date","toISOString","split","getTime","days_ahead","trip_days","outbound_departure_timestamp","outbound_departure_date","outbound_arrival_timestamp","outbound_arrival_date","inbound_departure_timestamp","inbound_departure_date","inbound_arrival_timestamp","inbound_arrival_date","product_outbound_flight","Product","name","id","category","brand","price","round","custom_attributes","total_product_amount","product_outbound_flight_bundle","product_outbound_flight_seats","product_inbound_flight","product_inbound_flight_bundle","product_inbound_flight_seats","product_action","ProductAction","products","total_amount","tax_amount","transaction_id","commerce_event","CommerceEvent","timestamp_unixtime_ms","now","addEvent","body","callback","data","response","send","header","JSON","stringify","bulkUploadEvents","check_in","event","AppEvent","CustomEventType","other","flight_update","logger","BigQuery","bigquery","affected_passengers","audience_query","flight_no","departure_date","options","location","job","createQueryJob","rows","getQueryResults","batches","i","buy_coin","sel","weighted_random_choice","total","threshold","d_games","a_lw_coins","a_lw_extra","a_coins","a_stellars","type","game","pm_product","product_set","randomCoins","c_sel","randomExtra","e_sel","currency_code","buy_matas","a_categories","a_prod_items","matas_product","coupon_code","value","entries","substring","ceil","buy_puc","a_Stores","puc_product","push_notification","exec","s_cmd","stdout","stderr","s_campaign_id","trim","profile","fetch","s_token","request_token","e","headers","client_id","client_secret","audience","grant_type","mode","method","t","json","access_token","request_user_profile","wSID","mPID","Authorization","user_profile","https","http","cors","app","mparticle","use","static","join","__dirname"],"mappings":"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","file":"index.js","sourceRoot":"../src","sourcesContent":["const { parse } = require(\"csv-parse\");\nconst fs = require('fs');\nconst path = require('path');\n\nvar flights = {}\nvar flight_search = {}\nvar airport_code = {}\n\nvar eJ_flight_price = {\n    \"Unit_Price\": 0.1,\n    \"Extra Legroom\": [0.3, 0.4],\n    \"Up Front\": [0.2, 0.3, 0.4],\n    \"Standard\": [0.0],\n    \"Standard Plus\": [0.3, 0.4],\n    \"Essentials\": [0.5, 0.6],\n    \"Large Cabin Bag\":[0.12, 0.25],\n    \"15kg Hold Bag\": [0.25, 0.35, 0.55],\n    \"23kg Hold Bag\": [0.45, 0.65],\n    \"26kg Hold Bag\": [0.4, 0.6],\n    \"Discount\": [0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.2, 0.25, 0.3, 0.35],\n    \"Inspire_Me_Type\": \"I don't mind|City explorer|Adventure and the great outdoors|Family holiday|Foodies|Going solo|Honeymoons and romance|Inspired by movies and TV|Instagram hotspots|Music and festivals|Off the beaten track|Sand sun and swim|Snow and slopes (and a little apres)\",\n    \"Inspire_Me_Trip\": \"Anytime|Summer-23|Autumn-23|Winter-23\",\n    \"Inspire_Me_Time\": \"One-Way|7d-Return|14d-Return|Weekend-Return\"\n}\n\nfs.createReadStream(\"/Users/hsyang/Downloads/eCommerce - webApp/mP-Media/src/public/mp/flights-details.txt\")\n    .pipe(parse({ delimiter: \",\", from_line: 2 }))\n    .on(\"data\", function (row) {\n        flights[row[0]] = {};\n        flights[row[0]]['F-IATA'] = row[1]\n        flights[row[0]]['F-City'] = row[2]\n        flights[row[0]]['F-Country'] = row[3]\n        flights[row[0]]['F-Terminal'] = row[4]\n        flights[row[0]]['F-Time'] = row[5]\n        flights[row[0]]['T-IATA'] = row[6]\n        flights[row[0]]['T-City'] = row[7]\n        flights[row[0]]['T-Country'] = row[8]\n        flights[row[0]]['T-Terminal'] = row[9]\n        flights[row[0]]['T-Time'] = row[10]\n        flights[row[0]]['Distance'] = row[11]\n        flights[row[0]]['Duration'] = row[12]\n        \n        airport_code[row[2]] = row[1]\n        \n        if (typeof flight_search[row[2]] == \"undefined\") {\n            flight_search[row[2]] = {}\n            if (typeof flight_search[row[2]][row[7]] == \"undefined\") {\n                flight_search[row[2]][row[7]] = {}\n            }\n        } else {\n            if (typeof flight_search[row[2]][row[7]] == \"undefined\") {\n                flight_search[row[2]][row[7]] = {}\n            }\n        }\n        flight_search[row[2]][row[7]][row[5]] = row[0]\n    })\n    .on(\"error\", function (error) {\n        console.log(error.message);\n    })\n    .on(\"end\", function () {\n        console.log(\"Done\");\n    });\n\nmodule.exports = {\n    flights: flights,\n    flight_search: flight_search,\n    airport_code: airport_code,\n    eJ_flight_price: eJ_flight_price\n}","var express = require('express');\nvar book_flight = express.Router();\nvar mParticle = require('mparticle');\nconst {flights, flight_search, airport_code, eJ_flight_price} = require('./eJ_app.js');\n\n//https://demo.mp.com/mp/book_flight?customerid=98760614&from=London\n//mParticle Workshop ---> easyJet ---> Custom Feed ---> eRes System\nvar config = new mParticle.Configuration(\n    'us2-65576bc2bf1ec449bae46934f5e63182',\n    'lgWE_Irbh7hHA9VWJbX0jZr69W893eLs6I2kOI5gtDtvbsQ3zLuG_AaEOilt62W_');\n    //'us2-44914446e4bbc344892d3a67603d31b1',\n    //'TAZJMsciCeApddVJvK-BJq7PfNcOlxVlIEDk_SZQFYwiJVDGRC-Oag9PduYHNdND');\nvar apiClient = new mParticle.ApiClient()\napiClient.basePath = 'https://s2s.us2.mparticle.com/v2'\nvar api = new mParticle.EventsApi(config, apiClient);\n\nfunction random_flight(from, flight_search, to=\"\") {\n    \n    var matched = [];\n    Object.keys(flight_search).forEach(key => {\n        if (key.indexOf(from) >= 0) {\n            matched.push(key);\n        }\n    });\n    var from_city = random_choice(matched)\n    if (to == \"\") {\n        var to_city = random_choice(Object.keys(flight_search[from_city]))\n    } else {\n        var to_city = to\n    }\n    \n    return flight_search[from_city][to_city][random_choice(Object.keys(flight_search[from_city][to_city]))]\n    \n}\n\nfunction random_choice(a_src) {\n    return a_src[Math.floor(Math.random() * a_src.length)];\n}\n\nfunction uuidv4() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\n\nbook_flight.get('/', function(req, res) {\n    \n    var batch = new mParticle.Batch(mParticle.Batch.Environment.development);\n    batch.context = { \n        \"data_plan\": {\n            \"plan_id\": \"dp_example\",\n            \"plan_version\": 1\n        }\n    }\n    var user_identities = new mParticle.UserIdentities();\n    \n    user_identities.customerid = req.query['customerid']\n    batch.user_identities = user_identities;\n    batch.mp_deviceid = \"87d2ebaa-e956-407e-a1e6-f05f871bf4e6\"\n    \n    var outbound_flight = random_flight(req.query['from'], flight_search);\n    console.log(\"Outbound: \" + outbound_flight)\n    var outbound_flight_distance = flights[outbound_flight]['Distance']\n    var outbound_flight_duration = flights[outbound_flight]['Duration']\n    var inbound_flight = random_flight(flights[outbound_flight]['T-City'], flight_search, flights[outbound_flight]['F-City']);\n    var inbound_flight_distance = flights[inbound_flight]['Distance']\n    var inbound_flight_duration = flights[inbound_flight]['Duration']\n    var quantity = random_choice([1, 2, 3, 4])\n    \n    var curr_date_timestamp = (new Date(new Date().toISOString().split(\"T\")[0]+\"T00:00:00+00:00\")).getTime()\n    var days_ahead = Math.floor(Math.random() * 10) + 1;\n    var trip_days = random_choice([3, 5, 7, 10, 14])\n    var outbound_departure_timestamp = curr_date_timestamp + days_ahead * 86400 * 1000\n    var outbound_departure_date = (new Date(outbound_departure_timestamp).toISOString()).split(\"T\")[0]+\"T\"+flights[outbound_flight]['F-Time']+\":00+00:00\"\n    var outbound_arrival_timestamp = new Date(outbound_departure_date).getTime() + flights[outbound_flight]['Duration'] * 60 * 1000\n    var outbound_arrival_date = (new Date(outbound_arrival_timestamp).toISOString()).split(\".\")[0]+\"+00:00\"\n    var inbound_departure_timestamp = outbound_departure_timestamp + trip_days * 86400 * 1000\n    var inbound_departure_date = (new Date(inbound_departure_timestamp).toISOString()).split(\"T\")[0]+\"T\"+flights[inbound_flight]['F-Time']+\":00+00:00\"\n    var inbound_arrival_timestamp = new Date(inbound_departure_date).getTime() + flights[inbound_flight]['Duration'] * 60 * 1000\n    var inbound_arrival_date = (new Date(inbound_arrival_timestamp).toISOString()).split(\".\")[0]+\"+00:00\"   \n    \n    var product_outbound_flight = new mParticle.Product();\n    product_outbound_flight.name = 'Outbound Flight';\n    product_outbound_flight.id = outbound_flight + '-' + flights[outbound_flight]['F-IATA'] + '-' + flights[outbound_flight]['T-IATA'];\n    product_outbound_flight.category = \"Flights\"\n    product_outbound_flight.brand = \"easyJet\"\n    product_outbound_flight.quantity = quantity\n    product_outbound_flight.price = flights[outbound_flight]['Distance'] * random_choice(eJ_flight_price['Discount']);\n    product_outbound_flight.price = Math.round(product_outbound_flight.price * 100) / 100\n    product_outbound_flight.custom_attributes = {}\n    product_outbound_flight.custom_attributes['From'] = flights[outbound_flight]['F-City'] + \" - \" + flights[outbound_flight]['F-IATA']\n    product_outbound_flight.custom_attributes['To'] = flights[outbound_flight]['T-City'] + \" - \" + flights[outbound_flight]['T-IATA']\n    product_outbound_flight.custom_attributes['Flight_Distance'] = outbound_flight_distance\n    product_outbound_flight.custom_attributes['Flight_Duration'] = outbound_flight_duration\n    product_outbound_flight.custom_attributes['Departure_Time'] = outbound_departure_date\n    product_outbound_flight.custom_attributes['Arrival_Time'] = outbound_arrival_date\n    product_outbound_flight.total_product_amount = Math.round(product_outbound_flight.price * product_outbound_flight.quantity * 100) / 100\n    \n    var product_outbound_flight_bundle = new mParticle.Product();\n    product_outbound_flight_bundle.name = 'Outbound Flight Bundle';\n    product_outbound_flight_bundle.id = \"Flight Bundle\"\n    product_outbound_flight_bundle.category = \"Bundles\"\n    product_outbound_flight_bundle.brand = \"easyJet\"\n    product_outbound_flight_bundle.quantity = quantity\n    product_outbound_flight_bundle.custom_attributes = {}\n    product_outbound_flight_bundle.custom_attributes['Bundle'] = random_choice([\"Standard\", \"Standard Plus\", \"Essentials\"])\n    product_outbound_flight_bundle.price = product_outbound_flight.price * random_choice(eJ_flight_price[product_outbound_flight_bundle.custom_attributes['Bundle']])\n    product_outbound_flight_bundle.price = Math.round(product_outbound_flight_bundle.price * 100) / 100\n    product_outbound_flight_bundle.total_product_amount = Math.round(product_outbound_flight_bundle.price * product_outbound_flight_bundle.quantity * 100) / 100\n    \n    var product_outbound_flight_seats = new mParticle.Product();\n    product_outbound_flight_seats.name = 'Outbound Flight Seats';\n    product_outbound_flight_seats.id = \"Flight Seats\"\n    product_outbound_flight_seats.category = \"Seats\"\n    product_outbound_flight_seats.brand = \"easyJet\"\n    product_outbound_flight_seats.quantity = quantity\n    product_outbound_flight_seats.custom_attributes = {}\n    product_outbound_flight_seats.custom_attributes['Seat_Type'] = random_choice([\"Extra Legroom\", \"Up Front\", \"Standard\"])\n    product_outbound_flight_seats.price = product_outbound_flight.price * random_choice(eJ_flight_price[product_outbound_flight_seats.custom_attributes['Seat_Type']])\n    product_outbound_flight_seats.price = Math.round(product_outbound_flight_seats.price * 100) / 100\n    product_outbound_flight_seats.total_product_amount = Math.round(product_outbound_flight_seats.price * product_outbound_flight_seats.quantity * 100) / 100\n\n    var product_inbound_flight = new mParticle.Product();\n    product_inbound_flight.name = 'Inbound Flight';\n    product_inbound_flight.id = inbound_flight + '-' + flights[inbound_flight]['F-IATA'] + '-' + flights[inbound_flight]['T-IATA'];\n    product_inbound_flight.category = \"Flights\"\n    product_inbound_flight.brand = \"easyJet\"\n    product_inbound_flight.quantity = quantity\n    product_inbound_flight.price = flights[inbound_flight]['Distance'] * random_choice(eJ_flight_price['Discount']);\n    product_inbound_flight.price = Math.round(product_inbound_flight.price * 100) / 100\n    product_inbound_flight.custom_attributes = {}\n    product_inbound_flight.custom_attributes['From'] = flights[inbound_flight]['F-City'] + \" - \" + flights[outbound_flight]['F-IATA']\n    product_inbound_flight.custom_attributes['To'] = flights[inbound_flight]['T-City'] + \" - \" + flights[outbound_flight]['T-IATA']\n    product_inbound_flight.custom_attributes['Flight_Distance'] = inbound_flight_distance\n    product_inbound_flight.custom_attributes['Flight_Duration'] = inbound_flight_duration\n    product_inbound_flight.custom_attributes['Departure_Time'] = inbound_departure_date\n    product_inbound_flight.custom_attributes['Arrival_Time'] = inbound_arrival_date\n    product_inbound_flight.total_product_amount = Math.round(product_inbound_flight.price * product_inbound_flight.quantity * 100) / 100\n    \n    var product_inbound_flight_bundle = new mParticle.Product();\n    product_inbound_flight_bundle.name = 'Inbound Flight Bundle';\n    product_inbound_flight_bundle.id = \"Flight Bundle\"\n    product_inbound_flight_bundle.category = \"Bundles\"\n    product_inbound_flight_bundle.brand = \"easyJet\"\n    product_inbound_flight_bundle.quantity = quantity\n    product_inbound_flight_bundle.custom_attributes = {}\n    product_inbound_flight_bundle.custom_attributes['Bundle'] = random_choice([\"Standard\", \"Standard Plus\", \"Essentials\"])\n    product_inbound_flight_bundle.price = product_inbound_flight.price * random_choice(eJ_flight_price[product_inbound_flight_bundle.custom_attributes['Bundle']])\n    product_inbound_flight_bundle.price = Math.round(product_inbound_flight_bundle.price * 100) / 100\n    product_inbound_flight_bundle.total_product_amount = Math.round(product_inbound_flight_bundle.price * product_inbound_flight_bundle.quantity * 100) / 100\n    \n    var product_inbound_flight_seats = new mParticle.Product();\n    product_inbound_flight_seats.name = 'Inbound Flight Seats';\n    product_inbound_flight_seats.id = \"Flight Seats\"\n    product_inbound_flight_seats.category = \"Seats\"\n    product_inbound_flight_seats.brand = \"easyJet\"\n    product_inbound_flight_seats.quantity = quantity\n    product_inbound_flight_seats.custom_attributes = {}\n    product_inbound_flight_seats.custom_attributes['Seat_Type'] = random_choice([\"Extra Legroom\", \"Up Front\", \"Standard\"])\n    product_inbound_flight_seats.price = product_inbound_flight.price * random_choice(eJ_flight_price[product_inbound_flight_seats.custom_attributes['Seat_Type']])\n    product_inbound_flight_seats.price = Math.round(product_inbound_flight_seats.price * 100) / 100\n    product_inbound_flight_seats.total_product_amount = Math.round(product_inbound_flight_seats.price * product_inbound_flight_seats.quantity * 100) / 100\n    \n    var product_action = new mParticle.ProductAction('purchase');\n    product_action.products = [product_outbound_flight, product_outbound_flight_bundle, product_outbound_flight_seats, product_inbound_flight, product_inbound_flight_bundle, product_inbound_flight_seats];\n    \n    product_action.total_amount = product_outbound_flight.total_product_amount + product_outbound_flight_bundle.total_product_amount + product_outbound_flight_seats.total_product_amount + product_inbound_flight.total_product_amount + product_inbound_flight_bundle.total_product_amount +\n    product_inbound_flight_seats.total_product_amount;\n    product_action.tax_amount = Math.round(product_action.total_amount * 0.2 * 100) / 100;\n    \n    product_action.transaction_id = \"eJ-Mobile-\" + uuidv4();\n\n    var commerce_event = new mParticle.CommerceEvent();\n    commerce_event.product_action = product_action;\n    commerce_event.timestamp_unixtime_ms = Date.now(); //replace with time of transaction\n\n    batch.addEvent(commerce_event);\n    \n    var body = [batch]\n    var callback = function(error, data, response) {\n        if (error) {\n            res.send('Error: ' + error);\n        } else {\n            res.header(\"Content-Type\",'application/json');\n            res.send(JSON.stringify({\n                'Outbound_Flight': outbound_flight,\n                'Outbound_Flight_Airport': flights[outbound_flight]['F-City'],\n                'Outbound_Flight_Arrival_Airport': flights[outbound_flight]['T-City'],\n                'Outbound_Flight_Departure_Date': outbound_departure_date\n            }, null, 4));\n        }\n    };\n\n    api.bulkUploadEvents(body, callback);\n\n});\n\nmodule.exports = book_flight;","'use strict'\n\nvar express = require('express');\nvar check_in = express.Router();\nvar mParticle = require('mparticle');\nconst {flights, flight_search, airport_code, eJ_flight_price} = require('./eJ_app.js');\n\n//https://demo.mp.com/mp/check_in?customerid=98760603&flight=EZY8105&departure_date=2023-06-21T06:30:00+00:00\n//mParticle Workshop ---> easyJet ---> Custom Feed ---> Levarti (Disruption)\nvar config = new mParticle.Configuration(\n    'us2-0de9a21b32cca340b649e7886c134428',\n    'hsVsm8K6ZEvD7J0XPrIrURMxpafHXf9niCIhz21q3-dsZrtUXSk5nmdSd2P_ME7m'\n);\nvar apiClient = new mParticle.ApiClient();\napiClient.basePath = 'https://s2s.us2.mparticle.com/v2';\nvar api = new mParticle.EventsApi(config, apiClient);\n\ncheck_in.get('/', function(req, res) {\n    \n    var batch = new mParticle.Batch(mParticle.Batch.Environment.development);\n    batch.context = { \n        \"data_plan\": {\n            \"plan_id\": \"dp_example\",\n            \"plan_version\": 1\n        }\n    }\n    var user_identities = new mParticle.UserIdentities();\n    \n    user_identities.customerid = req.query['customerid'];\n    batch.user_identities = user_identities;\n    batch.mp_deviceid = '48ad4e3b-4137-4ed0-93db-69c896116767';\n    \n    var event = new mParticle.AppEvent(mParticle.AppEvent.CustomEventType.other, 'flight_check_in');\n    event.custom_attributes = {\n        \"Flight_No.\": req.query['flight'],\n        \"Departure_Airport\": flights[req.query['flight']]['F-City'],\n        \"Arrival_Airport\": flights[req.query['flight']]['T-City'],\n        \"Departure_Time\": req.query['departure_date'],\n        \"Flight_Distance\": flights[req.query['flight']]['Distance'],\n        \"Flight_Duration\": flights[req.query['flight']]['Duration'],\n        \"Checkin_Time\": (new Date().toISOString().split(\".\")[0]+\"+00:00\")\n    };\n  \n    batch.addEvent(event);\n    \n    var body = [batch];\n    var callback = function(error, data, response) {\n        if (error) {\n            res.send('Error: ' + error);\n        } else {\n            res.header(\"Content-Type\",'application/json');\n            res.send(JSON.stringify({\n                'Checked-In': req.query['flight'],\n                'Distance': flights[req.query['flight']]['Distance'],\n                'Duration': flights[req.query['flight']]['Duration']\n            }, null, 4))\n        }\n    };\n\n    api.bulkUploadEvents(body, callback);\n    \n});\n\nmodule.exports = check_in;","var express = require('express');\nvar flight_update = express.Router();\nvar mParticle = require('mparticle');\nvar logger = require('morgan');\nconst {flights, flight_search, airport_code, eJ_flight_price} = require('./eJ_app.js');\n\nconst {BigQuery} = require('@google-cloud/bigquery');\nconst bigquery = new BigQuery();\n\n//https://demo.mp.com/mp/flight_update?flight=EZY7512&departure_date=2023-07-23&delay=180\n//mParticle Workshop ---> easyJet ---> Custom Feed ---> Levarti (Disruption)\nvar config = new mParticle.Configuration(\n    'us2-0de9a21b32cca340b649e7886c134428',\n    'hsVsm8K6ZEvD7J0XPrIrURMxpafHXf9niCIhz21q3-dsZrtUXSk5nmdSd2P_ME7m'\n);\nvar apiClient = new mParticle.ApiClient();\napiClient.basePath = 'https://s2s.us2.mparticle.com/v2';\nvar api = new mParticle.EventsApi(config, apiClient);\n\nvar affected_passengers = [];\n\nasync function audience_query(flight_no, departure_date) {\n\n    const query = 'SELECT customerid, mpid, firstname, lastname, gender, outbound_flight, outbound_departure_date, inbound_flight, inbound_departure_date FROM ops-8075.Views.view_departure WHERE (outbound_flight LIKE \\'' + flight_no + '%\\' AND outbound_departure_date LIKE \\'' + departure_date + '%\\') OR (inbound_flight LIKE ' +  '\\'' + flight_no + '%\\' AND inbound_departure_date LIKE \\'' + departure_date + '%\\')';\n\n    // For all options, see https://cloud.google.com/bigquery/docs/reference/rest/v2/jobs/query\n    const options = {\n        query: query,\n        // Location must match that of the dataset(s) referenced in the query.\n        location: 'US',\n    };\n\n    // Run the query as a job\n    const [job] = await bigquery.createQueryJob(options);\n\n    // Wait for the query to finish\n    const [rows] = await job.getQueryResults();\n\n    // Print the results\n    rows.forEach(row => affected_passengers.push(row));\n}\n\nflight_update.get('/', async function(req, res) {\n\n    await audience_query(req.query['flight'], req.query['departure_date']);\n    console.log('affected passgeners: ' + affected_passengers.length)\n\n    var batches = []\n    for (var i=0; i<affected_passengers.length; i++) {\n        var batch = new mParticle.Batch(mParticle.Batch.Environment.development);\n        batch.context = { \n            \"data_plan\": {\n                \"plan_id\": \"dp_example\",\n                \"plan_version\": 1\n            }\n        }\n        var user_identities = new mParticle.UserIdentities();\n    \n        user_identities.customerid = affected_passengers[i]['customerid'];\n        batch.user_identities = user_identities;\n        batch.mp_deviceid = '48ad4e3b-4137-4ed0-93db-69c896116767';\n    \n        var event = new mParticle.AppEvent(mParticle.AppEvent.CustomEventType.other, 'flight_update');\n        event.custom_attributes = {\n            \"Flight_No.\": affected_passengers[i]['outbound_flight'].indexOf(req.query['flight']) > -1 ? affected_passengers[i]['outbound_flight']:affected_passengers[i]['inbound_flight'],\n            \"Passenger\": affected_passengers[i]['gender'].indexOf('M') > -1 ? \"Mr. \" + affected_passengers[i]['firstname'] + \" \" + affected_passengers[i]['lastname'] : \"Mrs. \" + affected_passengers[i]['firstname'] + \" \" + affected_passengers[i]['lastname'],\n            \"Departure_Airport\": flights[req.query['flight']]['F-City'],\n            \"Arrival_Airport\": flights[req.query['flight']]['T-City'],\n            \"Departure_Time\": req.query['departure_date'] + \"T\" + flights[req.query['flight']]['F-Time'] + \":00+00:00\",\n            \"Delay_Time\": req.query['delay']\n        };\n  \n        batch.addEvent(event);\n        batches.push(batch);\n    }\n\n    if (affected_passengers.length > 0) {\n        var callback = function(error, data, response) {\n            if (error) {\n                res.send('Error: ' + error);\n            } else {\n                res.header(\"Content-Type\",'application/json');\n                res.send(JSON.stringify({\n                    \"Flight_No.\": req.query['flight'],\n                    \"Departure_Airport\": flights[req.query['flight']]['F-City'],\n                    \"Arrival_Airport\": flights[req.query['flight']]['T-City'],\n                    \"Departure_Time\": req.query['departure_date'] + \"T\" + flights[req.query['flight']]['F-Time'] + \":00+00:00\",\n                    \"Delay_Time\": req.query['delay']\n                }, null, 4));\n            }\n        }\n        api.bulkUploadEvents(batches, callback);\n    }\n    \n});\n\nmodule.exports = flight_update;","var express = require('express');\nvar buy_coin = express.Router();\nvar mParticle = require('mparticle');\n\n//https://demo.mp.com/mp/buy_coin?customerid=98760603&token=220672716078290600703\n//mParticle Workshop ---> easyJet ---> Custom Feed ---> eRes System\nvar config = new mParticle.Configuration(\n    'us2-df5e5532f3db7f4b8365fb6fa1e3ad6a',\n    'h0KGtAfdvVB-OFaeyV9zAnQNXXUjybgOTEQetk_lmbqOWgFetL4jfSpDJvWSz_mq');\nvar apiClient = new mParticle.ApiClient()\napiClient.basePath = 'https://s2s.us2.mparticle.com/v2'\nvar api = new mParticle.EventsApi(config, apiClient);\n\nfunction random_choice(a_src) {\n    var sel = Math.floor(Math.random() * a_src.length)\n    return [a_src[sel], sel];\n}\n\nfunction weighted_random_choice(data) {\n    let total = 0;\n    for (let i = 0; i < data.length; ++i) {\n        total += data[i][1];\n    }\n    // Total in hand, we can now pick a random value akin to our\n    // random index from before.\n    const threshold = Math.random() * total;\n    \n    total = 0;\n    for (let i = 0; i < data.length - 1; ++i) {\n        // Add the weight to our running total.\n        total += data[i][1];\n\n        // If this value falls within the threshold, we're done!\n        if (total >= threshold) {\n            return [data[i][0], i];\n        }\n    }\n\n    // Wouldn't you know it, we needed the very last entry!\n    return [data[data.length - 1][0], data.length - 1];\n}\n\nfunction uuidv4() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\n\nbuy_coin.get('/', function(req, res) {\n    \n    var batch = new mParticle.Batch(mParticle.Batch.Environment.development);\n    batch.context = { \n        \"data_plan\": {\n            \"plan_id\": \"dp_example\",\n            \"plan_version\": 1\n        }\n    }\n    var user_identities = new mParticle.UserIdentities();\n    \n    if ('customerid' in req.query) {\n        user_identities.customerid = req.query['customerid']\n    }\n    batch.user_identities = user_identities;\n    batch.mp_deviceid = \"87d2ebaa-e956-407e-a1e6-f05f871bf4e6\"\n    \n    let d_games = {\n        \"LL\": \"Lightning Link\",\n        \"MF\": \"Mighty Fu\",\n        \"CM\": \"Cashman\",\n        \"HV\": \"Heart of Vegas\"\n    };\n    \n    let a_lw_coins = [\n        [[\"4.75M\", 4750000], 0.375],\n        [[\"4.25M\", 4250000], 0.33],\n        [[\"5.25M\", 5250000], 0.12],\n        [[\"6.75M\", 6750000], 0.07],\n        [[\"8M\", 8000000], 0.03],\n        [[\"6M\", 6000000], 0.044]\n    ];\n    \n    let a_lw_extra = [\n        [[\"Orbs\", \"RARE\"], 0.32],\n        [[\"Stellar\", 15000], 0.30],\n        [[\"Orbs\", \"UNCOMMON\"], 0.30],\n        [[\"Ligtning Boost\", \"10Mins\"], 0.02],\n        [[\"Stellar\", 20000], 0.03],\n        [[\"Orbs\", \"EPIC\"], 0.01]\n    ];\n\n    let a_coins = [\n        [\"600% MORE\", 110000000, 99.99],\n        [\"GOOD VALUE\", 320000, 1.99],\n        [\"400% MORE\", 38000000, 49.99],\n        [\"300% MORE\", 13000000, 19.99],\n        [\"65% MORE\", 1300000, 4.99],\n        [\"150% MORE\", 4000000, 9.99],\n        [\"GREAT VALUE\", 1000000, 2.99]\n    ];\n    \n    let a_stellars = [\n        [\"700% MORE\", 1000000, 99.99],\n        [\"GOOD VALUE\", 2500, 1.99],\n        [\"460% MORE\", 350000, 49.99],\n        [\"300% MORe\", 100000, 19.99],\n        [\"60% MORE\", 10000, 4.99],\n        [\"140% MORE\", 30000, 9.99],\n        [\"GREAT VALUE\", 4000, 2.99]\n    ];\n    \n    var type = 'type' in req.query?req.query['type']:random_choice([\"Coin\", \"Stellar\", \"Wheel\"])[0];\n    var game = 'game' in req.query?req.query['game']:random_choice(Object.keys(d_games))[0];\n    var pm_product = new mParticle.Product();\n    \n    if (type == \"Coin\") {\n        var [product_set, sel] = random_choice(a_coins);\n        //console.log(\"Product Set: \" + product_set)\n        pm_product.name = \"Coins - \" + product_set[0];\n        pm_product.id = game + \"-COIN-00\" + (sel + 1);\n        pm_product.brand = \"Product Madness\";\n        pm_product.category = d_games[game];\n        pm_product.quantity = 1;\n        pm_product.price = product_set[2];\n        pm_product.custom_attributes = {};\n        pm_product.custom_attributes['Coins_Amount'] = product_set[1];\n        pm_product.total_product_amount = pm_product.quantity * pm_product.price;\n    } else if (type == \"Stellar\") {\n        var [product_set, sel] = random_choice(a_stellars);\n        pm_product.name = \"Stellars - \" + product_set[0];\n        pm_product.id = game + \"-STELLAR-00\" + (sel + 1);\n        pm_product.brand = \"Product Madness\";\n        pm_product.category = d_games[game];\n        pm_product.quantity = 1;\n        pm_product.price = product_set[2];\n        pm_product.custom_attributes = {};\n        pm_product.custom_attributes['Stellars_Amount'] = product_set[1];\n        pm_product.total_product_amount = pm_product.quantity * pm_product.price;\n    } else if (type == \"Wheel\") {\n        var [randomCoins, c_sel] = weighted_random_choice(a_lw_coins);\n        var [randomExtra, e_sel] = weighted_random_choice(a_lw_extra);\n        pm_product.name = \"DRAW - \" + randomCoins[0] + \" + \" + randomExtra[0];\n        pm_product.id = game + \"-DRAW-00\" + (c_sel + 1);\n        pm_product.brand = \"Product Madness\";\n        pm_product.category = d_games[game];\n        pm_product.quantity = 1;\n        pm_product.price = 9.99;\n        pm_product.custom_attributes = {};\n        pm_product.custom_attributes['Coins_Amount'] = randomCoins[1];\n        pm_product.custom_attributes['Extra_Type'] = randomExtra[0];\n        pm_product.custom_attributes['Extra_Unit'] = randomExtra[1];\n        pm_product.total_product_amount = pm_product.quantity * pm_product.price;\n    }\n    \n    var product_action = new mParticle.ProductAction('purchase');\n    product_action.products = [pm_product];\n    product_action.total_amount = 0;\n    for (var i = 0; i < product_action.products.length; i++) {\n        product_action.total_amount += product_action.products[i].total_product_amount;\n    }\n    product_action.tax_amount = Math.round(product_action.total_amount * 0.2 * 100) / 100;\n    product_action.transaction_id = \"PM-\" + game + \"-\" + uuidv4();\n\n    var commerce_event = new mParticle.CommerceEvent();\n    commerce_event.product_action = product_action;\n    commerce_event.currency_code = \"GBP\";\n    commerce_event.custom_attributes = {};\n    commerce_event.custom_attributes['Payment_Type'] = \"In App Purchase\";\n    commerce_event.custom_attributes['Game'] = d_games[game];\n    if ('token' in req.query) {\n        commerce_event.custom_attributes['Token'] = req.query['token'];\n    }\n    commerce_event.timestamp_unixtime_ms = Date.now(); //replace with time of transaction\n\n    batch.addEvent(commerce_event);\n    \n    var body = [batch]\n    var callback = function(error, data, response) {\n        if (error) {\n            res.send('Error: ' + error);\n        } else {\n            res.header(\"Content-Type\",'application/json');\n            res.send(JSON.stringify({\n                'Game': d_games[game],\n                'Payment_Amount': product_action.total_amount,\n                'Purchase_Item': type == \"Stellar\"?\"Stellars\": \"Coins\",\n                'Purchase_Amount': type == \"Stellar\"?pm_product.custom_attributes['Stellars_Amount']:pm_product.custom_attributes['Coins_Amount']\n            }, null, 4));\n        }\n    };\n\n    api.bulkUploadEvents(body, callback);\n\n});\n\nmodule.exports = buy_coin;\n","var express = require('express');\nvar buy_matas = express.Router();\nvar mParticle = require('mparticle');\n\n//https://demo.mp.com/mp/buy_matas?customerid=31160825\n//mParticle Workshop ---> easyJet ---> Custom Feed ---> eRes System\nvar config = new mParticle.Configuration(\n    'us2-0c40b6fcec02354f9179838bc68c8edf',\n    '_FME4g_b9pFY8iAglexCpx9Qt7IA7uhAzvzfgUzI_xo1rCeRntktI7gStxUPuLy3');\nvar apiClient = new mParticle.ApiClient()\napiClient.basePath = 'https://s2s.us2.mparticle.com/v2'\nvar api = new mParticle.EventsApi(config, apiClient);\n\nfunction random_choice(a_src) {\n    var sel = Math.floor(Math.random() * a_src.length)\n    return [a_src[sel], sel];\n}\n\nfunction weighted_random_choice(data) {\n    let total = 0;\n    for (let i = 0; i < data.length; ++i) {\n        total += data[i][1];\n    }\n    // Total in hand, we can now pick a random value akin to our\n    // random index from before.\n    const threshold = Math.random() * total;\n    \n    total = 0;\n    for (let i = 0; i < data.length - 1; ++i) {\n        // Add the weight to our running total.\n        total += data[i][1];\n\n        // If this value falls within the threshold, we're done!\n        if (total >= threshold) {\n            return [data[i][0], i];\n        }\n    }\n\n    // Wouldn't you know it, we needed the very last entry!\n    return [data[data.length - 1][0], data.length - 1];\n}\n\nfunction uuidv4() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\n\nbuy_matas.get('/', function(req, res) {\n    \n    var batch = new mParticle.Batch(mParticle.Batch.Environment.development);\n    batch.context = { \n        \"data_plan\": {\n            \"plan_id\": \"dp_example\",\n            \"plan_version\": 1\n        }\n    }\n    var user_identities = new mParticle.UserIdentities();\n    \n    if ('customerid' in req.query) {\n        user_identities.customerid = req.query['customerid']\n    }\n    batch.user_identities = user_identities;\n    batch.mp_deviceid = \"a8d2ebab-e956-407e-a1e6-f05f871bb9f3\"\n    \n    let a_categories = {\n        \"Skin Care\": [\n            \"Facial Care\",\n            \"Body Care\",\n            \"Dermatological and Special Skin Care\",\n            \"For Mother & Child\",\n            \"Hair Removal\",\n            \"Sun Care\"\n        ],\n        \"Perfumes & Fragrances\": [\n            \"To her\",\n            \"For him\",\n            \"Perfumes\",\n            \"Deodorants\",\n            \"Fragrance for the Home\",\n            \"Shop by Fragrance Family\"\n        ],\n        \"Makeup\": [\n            \"Face\",\n            \"Eyes\",\n            \"Lips\",\n            \"Nails\",\n            \"Accessories\"\n        ],\n        \"Hair\": [\n            \"Shampoo & Hair Care\",\n            \"Hair Colour\",\n            \"Hair Styling\",\n            \"Styling Tools\",\n            \"Hair Cutting\",\n            \"Beard Care\",\n            \"Food Supplements for Hair\",\n            \"Professional Hair Care\",\n            \"Accessories for Hair\"\n        ],\n        \"Health & Wellness\": [\n            \"Dietary supplements\",\n            \"Training & Nutrition\",\n            \"Food and Drinks\",\n            \"Sex & Cohabitation\",\n            \"Natural Remedies\",\n            \"Massage & Wellness\",\n            \"Homeopathy\",\n            \"Miscellaneous\"\n        ],\n        \"Medicine & Care\": [\n            \"Over the counter medicine\",\n            \"Allergy\",\n            \"Support bandage\",\n            \"Blood Pressure Monitors\",\n            \"Eczema & Dry Skin\",\n            \"Ticks & Fleas\",\n            \"Cold\",\n            \"Hands & Feet\",\n            \"Home Tests\",\n            \"Assistive devices\",\n            \"Hygiene\",\n            \"Nose\",\n            \"Patches\",\n            \"Lice\",\n            \"Light Therapy Lamps\",\n            \"Stomach problems\",\n            \"Mosquito\",\n            \"Sore Throat\",\n            \"Stop Smoking\",\n            \"Pain\",\n            \"The Snore\",\n            \"Mushroom\",\n            \"Wound Care\",\n            \"Thermometers\",\n            \"Motion Sickness\",\n            \"Eyes\",\n            \"Ears\"\n        ],\n        \"Clothes & Housing\": [\n            \"Clothes & Housing\",\n            \"Children & Parents\",\n            \"Men\",\n            \"Gifts\",\n            \"News\",\n            \"Talk to an expert\",\n            \"Clothes, Shoes & Accessories\",\n            \"Home interior\",\n            \"Electronics\",\n            \"Household\",\n            \"Accessories for Pets\",\n            \"Travel Accessories\"\n        ],\n        \"Children & Parents\": [\n            \"Breastfeeding and Bottle\",\n            \"The Child's Health\",\n            \"Nappy Time, Bath and Care\",\n            \"Pregnancy and Postpartum\",\n            \"Sleeping Time\",\n            \"Dinner Time\",\n            \"Toy\",\n            \"Baby Equipment\",\n            \"Children's Clothing\"\n        ],\n        \"Men\": [\n            \"Fragrance\",\n            \"Shaving\",\n            \"Beard Care\",\n            \"Skin Care\",\n            \"Hair\",\n            \"Body & Health\",\n            \"Makeup for Men\",\n            \"Men's Clothing\",\n            \"Accessories\"\n        ],\n        \"Gifts\": [\n            \"Gifts for Her\",\n            \"Gifts for Him\",\n            \"Gift Boxes\",\n            \"Gift Card\",\n            \"Host Gifts\",\n            \"Brand Days\"\n        ]\n    };\n    \n    var a_prod_items = [\n        [\"Balancing Force Oil Control Toner 198 ml\", \"714858\", 239.95, \"20%\", \"OLE HENRIKSEN\", \"Skin Care\", \"Facial Care - Cleaning Products - Skin Tonic\", {\"Volume\": \"198ml\"}, \"https://images.matas.dk/trs/w730//Assets_v3/500001-600000/504001-505000/504101-504200/504173/product_v1_x2.jpg\"],\n        [\"Expert Sun Protector SPF 50 + Face and Body 150 ml\", \"753709\", 364.95, \"0%\", \"SHISEIDO\", \"Skin Care\", \"Sun Care - Sun Cream - Sunscreen for the Body\", {\"Volume\": \"150ml\"}, \"https://images.matas.dk/trs/w730//Assets_v3/600001-700000/652001-653000/652601-652700/652686/product_v1_x2.jpg\"],\n        [\"Bedroom.Hair Hairspray 250 ml\", \"720815\", \"227.95\", \"0%\", \"KEVIN MURPHY\", \"Hair\", \"Hair Styling - Hair Spray\", {\"Volume\": \"250ml\"}, \"https://images.matas.dk/trs/w730//Assets_v3/700001-800000/718001-719000/718001-718100/718081/product_v1_x2.jpg\"],\n        [\"Sauvage Eau de Toilette 60 ml\", \"672698\", 659.95, \"0%\", \"DIOR\", \"Perfumes & Fragrances\", \"For Him - Eau de Toilette\", {\"Volume\": \"60ml\"}, \"https://images.matas.dk/trs/w730//Assets_v3/600001-700000/661001-662000/661601-661700/661648/product_v1_x2.jpg\"],\n        [\"Wake-Up Light HF3531/01\", \"749870\", 1599.0, \"0%\", \"PHILIPS\", \"Clothes & Housing\", \"Electronics - Lights & Lamps - Light Therapy Lamps\", {\"Colour\": \"Amber\"}, \"https://images.matas.dk/trs/w730//Assets_v3/700001-800000/765001-766000/765601-765700/765623/product_v1_x2.jpg\"]\n    ];\n\n    var matas_product = new mParticle.Product();\n    \n    var [product_set, sel] = random_choice(a_prod_items);\n    //console.log(\"Product Set: \" + product_set)\n    matas_product.name = product_set[0];\n    matas_product.id = product_set[1];\n    matas_product.brand = product_set[4];\n    matas_product.category = product_set[5];\n    matas_product.quantity = 1;\n    matas_product.price = product_set[2];\n    matas_product.coupon_code = product_set[3]\n    matas_product.custom_attributes = {};\n    for (const [key, value] of Object.entries(product_set[7])) {\n      //console.log(`${key}: ${value}`);\n      matas_product.custom_attributes[key] = value;\n    }\n    matas_product.custom_attributes[\"Sub Category\"] = product_set[6]\n    matas_product.total_product_amount = matas_product.quantity * matas_product.price * (100 - (matas_product.coupon_code.substring(0, matas_product.coupon_code.length - 1)))/100;\n\n    \n    var product_action = new mParticle.ProductAction('purchase');\n    product_action.products = [matas_product];\n    product_action.total_amount = 0;\n    for (var i = 0; i < product_action.products.length; i++) {\n        product_action.total_amount += product_action.products[i].total_product_amount;\n    }\n    product_action.tax_amount = Math.round(product_action.total_amount * 0.25 * 100) / 100;\n    product_action.transaction_id = \"Matas-\" + uuidv4();\n\n    var commerce_event = new mParticle.CommerceEvent();\n    commerce_event.product_action = product_action;\n    commerce_event.currency_code = \"DKK\";\n    commerce_event.custom_attributes = {};\n    commerce_event.custom_attributes['Payment_Type'] = random_choice([\"Dankort\", \"Mobile Pay\", \"Master Card\", \"Visa\", \"Anyday\"])[0];\n    commerce_event.custom_attributes['Delivery_Option'] = random_choice([\"In Store\", \"Matas\", \"GLS\", \"dao\", \"postnord\", \"instaBox\", \"Burd\"])[0];\n    commerce_event.custom_attributes['Club_Points'] = Math.ceil(product_action.total_amount/10);\n    if ('token' in req.query) {\n        commerce_event.custom_attributes['Token'] = req.query['token'];\n    }\n    commerce_event.timestamp_unixtime_ms = Date.now(); //replace with time of transaction\n\n    batch.addEvent(commerce_event);\n    \n    var body = [batch]\n    var callback = function(error, data, response) {\n        if (error) {\n            res.send('Error: ' + error);\n        } else {\n            res.header(\"Content-Type\",'application/json');\n            res.send(JSON.stringify({\n                'Product_Item': a_prod_items[sel][0],\n                'Payment_Amount': matas_product.total_product_amount.toString(),\n                \"Matas_Points\": (Math.ceil(product_action.total_amount/10)).toString(),\n                'Product_Image': a_prod_items[sel][8]\n            }, null, 4));\n        }\n    };\n\n    api.bulkUploadEvents(body, callback);\n\n});\n\nmodule.exports = buy_matas;\n","var express = require('express');\nvar buy_puc = express.Router();\nvar mParticle = require('mparticle');\n\n//https://demo.mp.com/mp/buy_puc?customerid=31160825\nvar config = new mParticle.Configuration(\n    'us2-0c40b6fcec02354f9179838bc68c8edf',\n    '_FME4g_b9pFY8iAglexCpx9Qt7IA7uhAzvzfgUzI_xo1rCeRntktI7gStxUPuLy3');\nvar apiClient = new mParticle.ApiClient()\napiClient.basePath = 'https://s2s.us2.mparticle.com/v2'\nvar api = new mParticle.EventsApi(config, apiClient);\n\nfunction random_choice(a_src) {\n    var sel = Math.floor(Math.random() * a_src.length)\n    return [a_src[sel], sel];\n}\n\nfunction weighted_random_choice(data) {\n    let total = 0;\n    for (let i = 0; i < data.length; ++i) {\n        total += data[i][1];\n    }\n    // Total in hand, we can now pick a random value akin to our\n    // random index from before.\n    const threshold = Math.random() * total;\n    \n    total = 0;\n    for (let i = 0; i < data.length - 1; ++i) {\n        // Add the weight to our running total.\n        total += data[i][1];\n\n        // If this value falls within the threshold, we're done!\n        if (total >= threshold) {\n            return [data[i][0], i];\n        }\n    }\n\n    // Wouldn't you know it, we needed the very last entry!\n    return [data[data.length - 1][0], data.length - 1];\n}\n\nfunction uuidv4() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\n\nbuy_puc.get('/', function(req, res) {\n    \n    var batch = new mParticle.Batch(mParticle.Batch.Environment.development);\n    batch.context = { \n        \"data_plan\": {\n            \"plan_id\": \"dp_example\",\n            \"plan_version\": 1\n        }\n    }\n    var user_identities = new mParticle.UserIdentities();\n    \n    if ('customerid' in req.query) {\n        user_identities.customerid = req.query['customerid']\n    }\n    batch.user_identities = user_identities;\n    batch.mp_deviceid = \"b9d2ebab-a768-048f-b2f8-eeb1042ac6d8\"\n    \n    let a_prod_items = [\n        [\"Marie Lund - Women's evening dress\", \"659162-0001\", 169.99, \"0%\", \"MARIE LUND\", \"Ladies\", \"Ladies - Clothing - Dresses\", {\"Size\": \"36\"}, \"https://static.vangraaf.com/img/Damen-Abendkleid_pdstandard_659162-0001_modelfront_1.jpg\"],\n        [\"Hugo - Men's Coat - H-Hyde-J-Bib-234\", \"650707-0001\", 549.99, \"0%\", \"HUGO\", \"Men's\", \"Men's - Clothing - Coats\", {\"Size\": \"52\"}, \"https://static.vangraaf.com/img/Herren-Mantel-H-Hyde-J-Bib-234_pdstandard_650707-0001_modelfront_1.jpg\"],\n        [\"Lloyd - Women's pumps\", \"679284-0002\", 119.99, \"0%\", \"LLOYD\", \"Ladies\", \"Ladies - Shoes - Pumps\", {\"size\": \"36\"}, \"https://static.vangraaf.com/img/Damen-Pumps_pdstandard_679284-0002_stillfront_1.jpg\"],\n        [\"Lego - Boys winter hat\", \"685310-0003\", 22.99, \"0%\", \"LEGO\", \"Kids & Teens\", \"Kids & Teens - Accessories - Hats & Caps\", {\"Size\": \"54 - 56\"}, \"https://static.vangraaf.com/img/Jungen-Winterm-tze_pdstandard-bust_685310-0003_bustfront_1.jpg\"],\n        [\"Izia - Girls summer dress\", \"660754-0001\", 149.99, \"21.4%\", \"IZIA\", \"Kids & Teens\", \"Kids & Teens - Clothing - Dresses & Skirts\", {\"Size\": \"122\"}, \"https://static.vangraaf.com/img/M-dchen-Sommerkleid_pdstandard_660754-0001_modelfront_1.jpg\"]\n    ];\n\n    let a_Stores = [\n        [\"Bielefeld\", \"33602\"], \n        [\"Braunschweig\", \"38100\"], \n        [\"Bremen, Obernstrasse\", \"28195\"], \n        [\"Bremen, Weserpark\", \"28307\"], \n        [\"Chemnitz\", \"09111\"], \n        [\"Dresden\", \"01067\"], \n        [\"Flensburg\", \"24937\"], \n        [\"Hamburg, Bergedorf\", \"21029\"], \n        [\"Hamburg, Mönckebergstraße\", \"20095\"], \n        [\"Hanover\", \"30159\"], \n        [\"Kiel\", \"24103\"], \n        [\"Hamburg, Elbe\", \"22609\"],\n        [\"Lüneburg\", \"21335\"],\n        [\"Norderstedt\", \"22850\"],\n        [\"Stralsund\", \"18439\"],\n        [\"Rostock\", \"18055\"]\n    ];\n    \n    var puc_product = new mParticle.Product();\n    \n    var [product_set, sel] = random_choice(a_prod_items);\n    //console.log(\"Product Set: \" + product_set)\n    puc_product.name = product_set[0];\n    puc_product.id = product_set[1];\n    puc_product.brand = product_set[4];\n    puc_product.category = product_set[5];\n    puc_product.quantity = 1;\n    puc_product.price = product_set[2];\n    puc_product.coupon_code = product_set[3]\n    puc_product.custom_attributes = {};\n    for (const [key, value] of Object.entries(product_set[7])) {\n      //console.log(`${key}: ${value}`);\n      puc_product.custom_attributes[key] = value;\n    }\n    puc_product.custom_attributes[\"Sub Category\"] = product_set[6]\n    puc_product.total_product_amount = puc_product.quantity * puc_product.price * (100 - (puc_product.coupon_code.substring(0, puc_product.coupon_code.length - 1)))/100;\n\n    \n    var product_action = new mParticle.ProductAction('purchase');\n    product_action.products = [puc_product];\n    product_action.total_amount = 0;\n    for (var i = 0; i < product_action.products.length; i++) {\n        product_action.total_amount += product_action.products[i].total_product_amount;\n    }\n    product_action.tax_amount = Math.round(product_action.total_amount * 0.19 * 100) / 100;\n    product_action.total_amount = Math.round(product_action.total_amount * 1.19 * 100) / 100\n    product_action.transaction_id = \"P&C-\" + uuidv4();\n\n    var commerce_event = new mParticle.CommerceEvent();\n    commerce_event.product_action = product_action;\n    commerce_event.currency_code = \"EUR\";\n    commerce_event.custom_attributes = {};\n    commerce_event.custom_attributes['Payment Type'] = random_choice([\"PayPal\", \"Klarna\", \"Master Card\", \"Visa\", \"American Express\"])[0];\n    commerce_event.custom_attributes['Delivery Option'] = random_choice([\"Click & Collect\", \"DHL\", \"Hermes\", \"In Store\"])[0];\n    if (commerce_event.custom_attributes['Delivery Option'] == \"Click & Collect\" || commerce_event.custom_attributes['Delivery Option'] == \"In Store\") {\n        commerce_event.custom_attributes['Store Name'] = random_choice(a_Stores)[0][0];\n        commerce_event.custom_attributes['Store Code'] = random_choice(a_Stores)[0][1];\n    }\n    commerce_event.custom_attributes['P&C* Points'] = Math.ceil(product_action.total_amount/10);\n    if ('token' in req.query) {\n        commerce_event.custom_attributes['Token'] = req.query['token'];\n    }\n    commerce_event.timestamp_unixtime_ms = Date.now(); //replace with time of transaction\n\n    batch.addEvent(commerce_event);\n    \n    var body = [batch]\n    var callback = function(error, data, response) {\n        if (error) {\n            res.send('Error: ' + error);\n        } else {\n            res.header(\"Content-Type\",'application/json');\n            res.send(JSON.stringify({\n                'Product_Item': a_prod_items[sel][0],\n                'Payment_Amount': puc_product.total_product_amount.toString(),\n                \"P&C*_Points\": (Math.ceil(product_action.total_amount/10)).toString(),\n                'Product_Image': a_prod_items[sel][8]\n            }, null, 4));\n        }\n    };\n\n    api.bulkUploadEvents(body, callback);\n\n});\n\nmodule.exports = buy_puc;\n","var express = require('express');\nvar push_notification = express.Router();\nvar mParticle = require('mparticle');\nvar logger = require('morgan');\nconst { exec } = require(\"child_process\");\n\n\n//https://demo.mp.com/mp/push_notification?customerid=31160825&title=Great%20Offer%21&body=You%20Cannot%20Miss%20This%21&app=Matas\nvar config = new mParticle.Configuration(\n    'us2-4a4f4fa3a0464a4492a543888119fe3e',\n    'xfgWFOlV_CO2ha65v5QK4Md8WXey1wIlm2N_qVJo6A-1fy0y1XMwFiWQRqCon0us');\nvar apiClient = new mParticle.ApiClient()\napiClient.basePath = 'https://s2s.us2.mparticle.com/v2'\nvar api = new mParticle.EventsApi(config, apiClient);\n\nfunction random_choice(a_src) {\n    var sel = Math.floor(Math.random() * a_src.length)\n    return [a_src[sel], sel];\n}\n\nfunction weighted_random_choice(data) {\n    let total = 0;\n    for (let i = 0; i < data.length; ++i) {\n        total += data[i][1];\n    }\n    // Total in hand, we can now pick a random value akin to our\n    // random index from before.\n    const threshold = Math.random() * total;\n    \n    total = 0;\n    for (let i = 0; i < data.length - 1; ++i) {\n        // Add the weight to our running total.\n        total += data[i][1];\n\n        // If this value falls within the threshold, we're done!\n        if (total >= threshold) {\n            return [data[i][0], i];\n        }\n    }\n\n    // Wouldn't you know it, we needed the very last entry!\n    return [data[data.length - 1][0], data.length - 1];\n}\n\nfunction uuidv4() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\n\npush_notification.get('/', function(req, res) {\n    var s_cmd = \"sleep 3;sed -i \\\"\\\" -e 's/^.*title.*$/            \\\"title\\\": \\\"\" + req.query['title'] + \"\\\"/' -e 's/^.*body.*$/            \\\"body\\\": \\\"\" + req.query['body'] + \"\\\",/' \\\"/Users/hsyang/Downloads/Prospects/Demo iOS App - \" + req.query['app'] + \"/push.json\\\";xcrun simctl push booted mParticle.demo-org \\\"/Users/hsyang/Downloads/Prospects/Demo iOS App - \" + req.query['app'] + \"/push.json\\\"\";\n    //console.log(s_cmd)\n    exec(s_cmd, (error, stdout, stderr) => {\n        if (error) {\n            console.log(`error: ${error.message}`);\n            return;\n        }\n        if (stderr) {\n            console.log(`stderr: ${stderr}`);\n            return;\n        }\n        \n        var batch = new mParticle.Batch(mParticle.Batch.Environment.development);\n        batch.context = { \n            \"data_plan\": {\n                \"plan_id\": \"dp_example\",\n                \"plan_version\": 1\n            }\n        }\n        \n        var user_identities = new mParticle.UserIdentities();\n    \n        if ('customerid' in req.query) {\n            user_identities.customerid = req.query['customerid']\n        }\n        batch.user_identities = user_identities;\n        batch.mp_deviceid = \"87d2ebaa-e956-407e-a1e6-f05f871bf4e6\"\n    \n        var s_campaign_id = \"2023-\" + uuidv4();\n        var event = new mParticle.AppEvent(mParticle.AppEvent.CustomEventType.other, 'Push Notification Deliveries');\n        event.custom_attributes = {\n            \"Campaign_Subject\": req.query['title'],\n            \"Campaign_ID\": s_campaign_id,\n            \"Mobile_ID\": req.query['customerid'],\n            \"Notfication_Time\": (new Date().toISOString().split(\".\")[0]+\"+00:00\")\n        };\n        \n        batch.addEvent(event);\n    \n        var body = [batch]\n        var callback = function(error, data, response) {\n            if (error) {\n                res.send('Error: ' + error);\n            } else {\n                res.header(\"Content-Type\",'application/json');\n                res.send(JSON.stringify({\n                    'Notification_Result': stdout.trim(),\n                    'Mobile_ID': req.query['customerid'],\n                    'Campaign_Subject': req.query['title'],\n                    'Campaign_ID': s_campaign_id\n                }, null, 4));\n            }\n        };\n\n        api.bulkUploadEvents(body, callback);\n    });\n\n});\n\nmodule.exports = push_notification;","'use strict'\n\nvar express = require('express');\nvar profile = express.Router();\nvar fetch = require('node-fetch');\n\nvar s_token = '';\nasync function request_token() {\n    var e = {\n        headers: {\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            //client_id: \"wawVx2Ejl0K2FUo79pyr6CQWyRmEuXSE\", //us2 mParticle Workshops\n            //client_secret: \"zK57_GIo6de0UHThW7iVEac3d6od4pRVDD0GbAcuaEpRZtlBTeXw0bxYf4KIhhvA\", //us2 mParticle Workshops\n            client_id: \"irrAuwex0d7calyRaknpCYE89omlKEDU\", //eu1 mParticle Workshops\n            client_secret: \"tMZaugEg57IyInCMiySuSU0c4UvB60s4C4ir5FH2tjzYScuUMcWaldjmE1rt9Lnn\", //eu1 mParticle Workshops\n            audience: \"https://api.mparticle.com\",\n            grant_type: \"client_credentials\"\n        }),\n        mode: \"no-cors\",\n        method: \"POST\"\n    };\n    var t = await (await fetch(\"https://sso.auth.mparticle.com/oauth/token\", e)).json();\n    s_token = t.access_token;\n    return s_token;\n}\n\nasync function request_user_profile(wSID, mPID) {\n    s_token = await request_token();\n    //var t = \"https://api.mparticle.com/userprofile/v1/5000011/167/\" + wSID + \"/\" + mPID + \"?fields=user_identities,user_attributes,audience_memberships,attribution\"; //us2 mParticle Workshops\n    var t = \"https://api.mparticle.com/userprofile/v1/4000268/374/\" + wSID + \"/\" + mPID + \"?fields=user_identities,user_attributes,audience_memberships,attribution\"; // eu1 mParticle Workshops\n    var e = {\n        headers: {\n            Authorization: \"Bearer \" + s_token\n        },\n        method: \"GET\"\n    };\n    var user_profile = await (await fetch(t, e)).json();\n    return user_profile\n}\n\nprofile.get('/', async function(req, res) {\n    if(req.query['mPID']) {\n        var user_profile = await request_user_profile(req.query['wSID'], req.query['mPID']);\n        res.send({\n            user_profile\n         });\n     } else {\n         res.send({});\n     }\n    \n});\n\nmodule.exports = profile;","const https = require('https');\r\nconst http = require('http');\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst cors = require('cors');\r\n\r\nvar express = require('express');\r\nvar logger = require('morgan');\r\nvar app = express();\r\nvar mparticle = require('mparticle');\r\n\r\n/*const options = {\r\n  key: fs.readFileSync('/usr/local/etc/nginx/key.pem'),\r\n  cert: fs.readFileSync('/usr/local/etc/nginx/cert.pem')\r\n};\r\n\r\nconst app = https.createServer(options, function (request, response) {\r\n  let filePath = path.join(__dirname, 'public', request.url);\r\n  if (filePath === path.join(__dirname, 'public', '/')) filePath = path.join(__dirname, 'public', 'index.html');\r\n\r\n  const extname = String(path.extname(filePath)).toLowerCase();\r\n  const contentType = mimeTypes[extname] || 'application/octet-stream';\r\n\r\n  fs.readFile(filePath, (error, content) => {\r\n    if (error) {\r\n      response.writeHead(500);\r\n      response.end(`Sorry, check with the site admin for error: ${error.code} ..\\n`);\r\n      response.end();\r\n    } else {\r\n      response.writeHead(200, { 'Content-Type': contentType });\r\n      response.end(content, 'utf-8');\r\n    }\r\n  });\r\n}).listen(443);*/\r\n\r\n/*https\r\n    .createServer(\r\n        {\r\n          key: fs.readFileSync(\"/usr/local/etc/nginx/key.pem\"),\r\n          cert: fs.readFileSync(\"/usr/local/etc/nginx/cert.pem\"),\r\n        },\r\n        app\r\n    ).listen(443, ()=>{\r\n        console.log('server is runing at port 443')\r\n    });\r\n\r\nhttp\r\n    .createServer(\r\n        app\r\n    ).listen(80, ()=>{\r\n        console.log('server is runing at port 80')\r\n    });*/\r\n\r\n// log requests\r\napp.use(cors());\r\napp.use(logger('dev'));\r\napp.use(express.static(path.join(__dirname, 'public')));\r\napp.use('/', express.static(path.join(__dirname, 'public', 'index.html')));\r\napp.use('/mp/book_flight', require('./public/mp/book-flight.js'));\r\napp.use('/mp/check_in', require('./public/mp/check-in.js'));\r\napp.use('/mp/flight_update', require('./public/mp/flight-update.js'));\r\napp.use('/mp/buy_coin', require('./public/mp/buy-coin.js'));\r\napp.use('/mp/buy_matas', require('./public/mp/buy-matas.js'));\r\napp.use('/mp/buy_puc', require('./public/mp/buy-puc.js'));\r\napp.use('/mp/push_notification', require('./public/mp/push-notification.js'));\r\napp.use('/mp/profile', require('./public/mp/profile.js'));\r\n\r\nmodule.exports = app;\r\n","const app = require('./app').app;\r\n//const flights = require('./app').flights;\r\n//console.log(\"index.js: \" + flights)\r\n\r\n/*const port = '443';\r\n\r\napp.listen(port, () => {\r\n  console.log(`Server is listening on port ${port}...`);\r\n});*/"]}